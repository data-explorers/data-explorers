import{S as re,i as oe,s as se,E as De,e as Y,c as $,a as x,d as C,N as ee,f as w,F as Ee,G as ve,H as Be,I as Ne,p as m,n as g,af as ze,W as ae,ag as Ae,a0 as te,v as T,w as D,x as E,O as He,A as v,u as Pe,j as Z,k as A,l as G,m as H,o as P,L as Q,t as Re,g as Ue}from"./vendor-35134e52.js";import{L as fe,E as Ze,a as Ge}from"./index-4cf94f11.js";import{s as Ve,i as le}from"./mapUtils-e9636914.js";import{c as We,d as qe,e as Fe,h as Je}from"./dataUtils-977db69d.js";import{M as Ke,a as Qe,b as Xe,S as Ye,R as $e,c as xe}from"./map_toggle_marker_type_button-8607250c.js";import{T as ie}from"./TileLayer-5fc507f7.js";import{C as ue}from"./CircleMarker-295969fc.js";import"./formatUtils-b852786f.js";import"./constants-3d7024b8.js";function et(s){let t,n,r;const e=s[5].default,f=De(e,s,s[4],null);return{c(){t=Y("div"),n=Y("div"),f&&f.c(),this.h()},l(l){t=$(l,"DIV",{style:!0});var o=x(t);n=$(o,"DIV",{});var i=x(n);f&&f.l(i),i.forEach(C),o.forEach(C),this.h()},h(){ee(t,"display","none")},m(l,o){w(l,t,o),Ee(t,n),f&&f.m(n,null),s[6](n),r=!0},p(l,[o]){f&&f.p&&(!r||o&16)&&ve(f,e,l,l[4],r?Ne(e,l[4],o,null):Be(l[4]),null)},i(l){r||(m(f,l),r=!0)},o(l){g(f,l),r=!1},d(l){l&&C(t),f&&f.d(l),s[6](null)}}}function tt(s,t,n){let{$$slots:r={},$$scope:e}=t;const{getLayer:f}=ze(fe.Layer);let{events:l=[]}=t,o,i;const _=ae();let S;Ae(()=>{S.unregister()});function b(){return o}function j(d){te[d?"unshift":"push"](()=>{i=d,n(0,i)})}return s.$$set=d=>{"events"in d&&n(1,l=d.events),"$$scope"in d&&n(4,e=d.$$scope)},s.$$.update=()=>{s.$$.dirty&11&&(o||(n(3,o=fe.popup()),S=new Ze(o,_,l),f().bindPopup(o)),o.setContent(i))},[i,l,b,o,e,r,j]}class lt extends re{constructor(t){super();oe(this,t,tt,et,se,{events:1,getPopup:2})}get getPopup(){return this.$$.ctx[2]}}function ce(s,t,n){const r=s.slice();return r[37]=t[n][0],r[38]=t[n][1],r}function me(s,t,n){const r=s.slice();return r[34]=t[n],r}function _e(s,t,n){const r=s.slice();return r[34]=t[n],r}function pe(s,t,n){const r=s.slice();return r[43]=t[n],r}function ge(s){let t,n;return t=new ie({props:{zIndex:201,url:s[43].InatTaxonRangeUrl}}),{c(){T(t.$$.fragment)},l(r){D(t.$$.fragment,r)},m(r,e){E(t,r,e),n=!0},p(r,e){const f={};e[0]&4&&(f.url=r[43].InatTaxonRangeUrl),t.$set(f)},i(r){n||(m(t.$$.fragment,r),n=!0)},o(r){g(t.$$.fragment,r),n=!1},d(r){v(t,r)}}}function he(s){let t,n;return t=new ie({props:{zIndex:201,url:s[43].InatGridUrl}}),{c(){T(t.$$.fragment)},l(r){D(t.$$.fragment,r)},m(r,e){E(t,r,e),n=!0},p(r,e){const f={};e[0]&4&&(f.url=r[43].InatGridUrl),t.$set(f)},i(r){n||(m(t.$$.fragment,r),n=!0)},o(r){g(t.$$.fragment,r),n=!1},d(r){v(t,r)}}}function ke(s){let t,n,r,e=s[43].showInatTaxonRange&&ge(s),f=s[43].showInatGrid&&he(s);return{c(){e&&e.c(),t=Z(),f&&f.c(),n=A()},l(l){e&&e.l(l),t=G(l),f&&f.l(l),n=A()},m(l,o){e&&e.m(l,o),w(l,t,o),f&&f.m(l,o),w(l,n,o),r=!0},p(l,o){l[43].showInatTaxonRange?e?(e.p(l,o),o[0]&4&&m(e,1)):(e=ge(l),e.c(),m(e,1),e.m(t.parentNode,t)):e&&(H(),g(e,1,1,()=>{e=null}),P()),l[43].showInatGrid?f?(f.p(l,o),o[0]&4&&m(f,1)):(f=he(l),f.c(),m(f,1),f.m(n.parentNode,n)):f&&(H(),g(f,1,1,()=>{f=null}),P())},i(l){r||(m(e),m(f),r=!0)},o(l){g(e),g(f),r=!1},d(l){e&&e.d(l),l&&C(t),f&&f.d(l),l&&C(n)}}}function nt(s){let t,n,r=[...s[7]],e=[];for(let l=0;l<r.length;l+=1)e[l]=de(ce(s,r,l));const f=l=>g(e[l],1,1,()=>{e[l]=null});return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=A()},l(l){for(let o=0;o<e.length;o+=1)e[o].l(l);t=A()},m(l,o){for(let i=0;i<e.length;i+=1)e[i].m(l,o);w(l,t,o),n=!0},p(l,o){if(o[0]&524416){r=[...l[7]];let i;for(i=0;i<r.length;i+=1){const _=ce(l,r,i);e[i]?(e[i].p(_,o),m(e[i],1)):(e[i]=de(_),e[i].c(),m(e[i],1),e[i].m(t.parentNode,t))}for(H(),i=r.length;i<e.length;i+=1)f(i);P()}},i(l){if(!n){for(let o=0;o<r.length;o+=1)m(e[o]);n=!0}},o(l){e=e.filter(Boolean);for(let o=0;o<e.length;o+=1)g(e[o]);n=!1},d(l){Q(e,l),l&&C(t)}}}function rt(s){let t,n,r=s[7],e=[];for(let l=0;l<r.length;l+=1)e[l]=Me(_e(s,r,l));const f=l=>g(e[l],1,1,()=>{e[l]=null});return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=A()},l(l){for(let o=0;o<e.length;o+=1)e[o].l(l);t=A()},m(l,o){for(let i=0;i<e.length;i+=1)e[i].m(l,o);w(l,t,o),n=!0},p(l,o){if(o[0]&524416){r=l[7];let i;for(i=0;i<r.length;i+=1){const _=_e(l,r,i);e[i]?(e[i].p(_,o),m(e[i],1)):(e[i]=Me(_),e[i].c(),m(e[i],1),e[i].m(t.parentNode,t))}for(H(),i=r.length;i<e.length;i+=1)f(i);P()}},i(l){if(!n){for(let o=0;o<r.length;o+=1)m(e[o]);n=!0}},o(l){e=e.filter(Boolean);for(let o=0;o<e.length;o+=1)g(e[o]);n=!1},d(l){Q(e,l),l&&C(t)}}}function ot(s){let t,n;return t=new xe({props:{items:s[7]}}),{c(){T(t.$$.fragment)},l(r){D(t.$$.fragment,r)},m(r,e){E(t,r,e),n=!0},p(r,e){const f={};e[0]&128&&(f.items=r[7]),t.$set(f)},i(r){n||(m(t.$$.fragment,r),n=!0)},o(r){g(t.$$.fragment,r),n=!1},d(r){v(t,r)}}}function be(s){let t,n;function r(...e){return s[29](s[34],...e)}return t=new ue({props:{events:["click"],latLng:[s[34].latitude,s[34].longitude],radius:ye,color:s[34].color,fillColor:s[34].fillColor}}),t.$on("click",r),{c(){T(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,f){E(t,e,f),n=!0},p(e,f){s=e;const l={};f[0]&128&&(l.latLng=[s[34].latitude,s[34].longitude]),f[0]&128&&(l.color=s[34].color),f[0]&128&&(l.fillColor=s[34].fillColor),t.$set(l)},i(e){n||(m(t.$$.fragment,e),n=!0)},o(e){g(t.$$.fragment,e),n=!1},d(e){v(t,e)}}}function de(s){let t,n,r=s[38],e=[];for(let l=0;l<r.length;l+=1)e[l]=be(me(s,r,l));const f=l=>g(e[l],1,1,()=>{e[l]=null});return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=A()},l(l){for(let o=0;o<e.length;o+=1)e[o].l(l);t=A()},m(l,o){for(let i=0;i<e.length;i+=1)e[i].m(l,o);w(l,t,o),n=!0},p(l,o){if(o[0]&524416){r=l[38];let i;for(i=0;i<r.length;i+=1){const _=me(l,r,i);e[i]?(e[i].p(_,o),m(e[i],1)):(e[i]=be(_),e[i].c(),m(e[i],1),e[i].m(t.parentNode,t))}for(H(),i=r.length;i<e.length;i+=1)f(i);P()}},i(l){if(!n){for(let o=0;o<r.length;o+=1)m(e[o]);n=!0}},o(l){e=e.filter(Boolean);for(let o=0;o<e.length;o+=1)g(e[o]);n=!1},d(l){Q(e,l),l&&C(t)}}}function Me(s){let t,n;function r(...e){return s[28](s[34],...e)}return t=new ue({props:{events:["click"],latLng:[s[34].latitude,s[34].longitude],radius:ye,color:s[34].color,fillColor:s[34].fillColor}}),t.$on("click",r),{c(){T(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,f){E(t,e,f),n=!0},p(e,f){s=e;const l={};f[0]&128&&(l.latLng=[s[34].latitude,s[34].longitude]),f[0]&128&&(l.color=s[34].color),f[0]&128&&(l.fillColor=s[34].fillColor),t.$set(l)},i(e){n||(m(t.$$.fragment,e),n=!0)},o(e){g(t.$$.fragment,e),n=!1},d(e){v(t,e)}}}function Ce(s){let t,n;return t=new $e({props:{latLngBounds:s[10],color:"#777",fillColor:"#777",$$slots:{default:[at]},$$scope:{ctx:s}}}),{c(){T(t.$$.fragment)},l(r){D(t.$$.fragment,r)},m(r,e){E(t,r,e),n=!0},p(r,e){const f={};e[0]&1024&&(f.latLngBounds=r[10]),e[1]&32768&&(f.$$scope={dirty:e,ctx:r}),t.$set(f)},i(r){n||(m(t.$$.fragment,r),n=!0)},o(r){g(t.$$.fragment,r),n=!1},d(r){v(t,r)}}}function st(s){let t;return{c(){t=Re("Demo map layer")},l(n){t=Ue(n,"Demo map layer")},m(n,r){w(n,t,r)},d(n){n&&C(t)}}}function at(s){let t,n;return t=new lt({props:{$$slots:{default:[st]},$$scope:{ctx:s}}}),{c(){T(t.$$.fragment)},l(r){D(t.$$.fragment,r)},m(r,e){E(t,r,e),n=!0},p(r,e){const f={};e[1]&32768&&(f.$$scope={dirty:e,ctx:r}),t.$set(f)},i(r){n||(m(t.$$.fragment,r),n=!0)},o(r){g(t.$$.fragment,r),n=!1},d(r){v(t,r)}}}function ft(s){let t,n,r,e,f,l,o,i,_,S,b,j,d,O;t=new Ke({props:{country:s[3],project:s[4]}});let k=s[2],p=[];for(let a=0;a<k.length;a+=1)p[a]=ke(pe(s,k,a));const K=a=>g(p[a],1,1,()=>{p[a]=null}),R=[ot,rt,nt],B=[];function q(a,c){return c[0]&128&&(e=null),a[11]?0:(e==null&&(e=!!Array.isArray(a[7])),e?1:2)}f=q(s,[-1,-1]),l=B[f]=R[f](s);let h=s[1]&&Ce(s);_=new Qe({props:{map:s[6],coordinates:s[9]}});let F={coordinates:s[9],useMarkerCluster:s[11],observationsOnMapCount:s[8],clusterLimit:ut,userSelectedMarkerType:s[12],zoomLevel:s[13],maxZoom:s[15]};return b=new Xe({props:F}),s[30](b),b.$on("changeMarkerModeOnClick",s[16]),b.$on("changeMarkerModeAutomatic",s[17]),d=new Ye({props:{position:"bottomleft",options:Ve}}),{c(){T(t.$$.fragment),n=Z();for(let a=0;a<p.length;a+=1)p[a].c();r=Z(),l.c(),o=Z(),h&&h.c(),i=Z(),T(_.$$.fragment),S=Z(),T(b.$$.fragment),j=Z(),T(d.$$.fragment)},l(a){D(t.$$.fragment,a),n=G(a);for(let c=0;c<p.length;c+=1)p[c].l(a);r=G(a),l.l(a),o=G(a),h&&h.l(a),i=G(a),D(_.$$.fragment,a),S=G(a),D(b.$$.fragment,a),j=G(a),D(d.$$.fragment,a)},m(a,c){E(t,a,c),w(a,n,c);for(let I=0;I<p.length;I+=1)p[I].m(a,c);w(a,r,c),B[f].m(a,c),w(a,o,c),h&&h.m(a,c),w(a,i,c),E(_,a,c),w(a,S,c),E(b,a,c),w(a,j,c),E(d,a,c),O=!0},p(a,c){const I={};if(c[0]&8&&(I.country=a[3]),c[0]&16&&(I.project=a[4]),t.$set(I),c[0]&4){k=a[2];let M;for(M=0;M<k.length;M+=1){const W=pe(a,k,M);p[M]?(p[M].p(W,c),m(p[M],1)):(p[M]=ke(W),p[M].c(),m(p[M],1),p[M].m(r.parentNode,r))}for(H(),M=k.length;M<p.length;M+=1)K(M);P()}let U=f;f=q(a,c),f===U?B[f].p(a,c):(H(),g(B[U],1,1,()=>{B[U]=null}),P(),l=B[f],l?l.p(a,c):(l=B[f]=R[f](a),l.c()),m(l,1),l.m(o.parentNode,o)),a[1]?h?(h.p(a,c),c[0]&2&&m(h,1)):(h=Ce(a),h.c(),m(h,1),h.m(i.parentNode,i)):h&&(H(),g(h,1,1,()=>{h=null}),P());const V={};c[0]&64&&(V.map=a[6]),c[0]&512&&(V.coordinates=a[9]),_.$set(V);const z={};c[0]&512&&(z.coordinates=a[9]),c[0]&2048&&(z.useMarkerCluster=a[11]),c[0]&256&&(z.observationsOnMapCount=a[8]),c[0]&4096&&(z.userSelectedMarkerType=a[12]),c[0]&8192&&(z.zoomLevel=a[13]),c[0]&32768&&(z.maxZoom=a[15]),b.$set(z)},i(a){if(!O){m(t.$$.fragment,a);for(let c=0;c<k.length;c+=1)m(p[c]);m(l),m(h),m(_.$$.fragment,a),m(b.$$.fragment,a),m(d.$$.fragment,a),O=!0}},o(a){g(t.$$.fragment,a),p=p.filter(Boolean);for(let c=0;c<p.length;c+=1)g(p[c]);g(l),g(h),g(_.$$.fragment,a),g(b.$$.fragment,a),g(d.$$.fragment,a),O=!1},d(a){v(t,a),a&&C(n),Q(p,a),a&&C(r),B[f].d(a),a&&C(o),h&&h.d(a),a&&C(i),v(_,a),a&&C(S),s[30](null),v(b,a),a&&C(j),v(d,a)}}}function it(s){let t,n,r,e,f,l={options:s[0],$$slots:{default:[ft]},$$scope:{ctx:s}};return n=new Ge({props:l}),s[31](n),{c(){t=Y("div"),T(n.$$.fragment),this.h()},l(o){t=$(o,"DIV",{style:!0});var i=x(t);D(n.$$.fragment,i),i.forEach(C),this.h()},h(){ee(t,"width","100%"),ee(t,"height","70vh")},m(o,i){w(o,t,i),E(n,t,null),r=!0,e||(f=He(window,"resize",s[18]),e=!0)},p(o,i){const _={};i[0]&1&&(_.options=o[0]),i[0]&65502|i[1]&32768&&(_.$$scope={dirty:i,ctx:o}),n.$set(_)},i(o){r||(m(n.$$.fragment,o),r=!0)},o(o){g(n.$$.fragment,o),r=!1},d(o){o&&C(t),s[31](null),v(n),e=!1,f()}}}let ye=7,ut=1e3,we=!1;function ct(s){let t=s.getBounds(),n=t.getEast(),r=t.getWest(),e=t.getNorth(),f=t.getSouth();var l=t.getEast()-t.getWest(),o=t.getNorth()-t.getSouth();return[[e-o*.3,n-l*.3],[f+o*.3,r+l*.3]]}function mt(s,t,n){let{mapOptions:r}=t,{groupedObservations:e}=t,{timeSpanHistory:f}=t,{showDemoMapLayer:l}=t,{taxaHistory:o}=t,{country:i}=t,{mapCenter:_}=t,{speciesOnMapCount:S}=t,{observersOnMapCount:b}=t,{speciesList:j}=t,{project:d}=t,O,k,p=[],K=[[0,0],[0,0]],R=!1,B="markers",q,h,F=[],a=[],c=0,I=!1,U=0;const V=ae();function z(u){n(11,R=u.detail.useMarkerCluster),n(12,B=u.detail.userSelectedMarkerType),n(7,a=W(a))}function M(u){n(11,R=u.detail.useMarkerCluster),n(7,a=W(a))}function W(u){let y;if(Array.isArray(u))y=u.filter(N=>le(N,k,L));else if(R){let N=[];u.forEach((J,ne)=>{J=J.filter(Te=>le(Te,k,L)),N=N.concat(J)}),y=N}else y=new Map,u.forEach((N,J)=>{N=N.filter(ne=>le(ne,k,L)),y.set(J,N)});return y}function Le(){k&&k.invalidateSize()}function X(u,y){V("markerClick",{observation_id:y.id,latlng:u.detail.latlng})}Pe(()=>{n(6,k=O.getMap()),n(10,K=ct(k)),n(15,U=k.getMaxZoom()),k.on("zoomend",function(){n(13,q=k.getZoom()),n(27,I=!0)}),k.on("moveend",function(){n(27,I=!0)}),k.on("baselayerchange",function(u){n(15,U=k.getMaxZoom())})});const Oe=(u,y)=>X(y,u),Se=(u,y)=>X(y,u);function je(u){te[u?"unshift":"push"](()=>{h=u,n(14,h)})}function Ie(u){te[u?"unshift":"push"](()=>{O=u,n(5,O)})}return s.$$set=u=>{"mapOptions"in u&&n(0,r=u.mapOptions),"groupedObservations"in u&&n(24,e=u.groupedObservations),"timeSpanHistory"in u&&n(25,f=u.timeSpanHistory),"showDemoMapLayer"in u&&n(1,l=u.showDemoMapLayer),"taxaHistory"in u&&n(2,o=u.taxaHistory),"country"in u&&n(3,i=u.country),"mapCenter"in u&&n(20,_=u.mapCenter),"speciesOnMapCount"in u&&n(21,S=u.speciesOnMapCount),"observersOnMapCount"in u&&n(22,b=u.observersOnMapCount),"speciesList"in u&&n(23,j=u.speciesList),"project"in u&&n(4,d=u.project)},s.$$.update=()=>{if(s.$$.dirty[0]&266338720&&O&&(n(26,F=We(e,f)),n(7,a=W(F)),n(8,c=qe(a)),n(23,j=Fe(a,we)),n(21,S=j.length),n(22,b=Je(a,we)),V("updateStats",{observationsOnMapCount:c,speciesOnMapCount:S,speciesList:j,observationsOnMap:a,observersOnMapCount:b}),n(27,I=!1)),s.$$.dirty[0]&16777252&&O)if(o.length>0)if(Array.isArray(e))n(9,p=e.map(u=>[u.latitude,u.longitude]));else{let u=[];n(9,p=e.forEach((y,N)=>{u=u.concat(y)})),n(9,p=u.map(y=>[y.latitude,y.longitude]))}else n(9,p=[]);if(s.$$.dirty[0]&1048608&&O&&_&&_.longitude){let u=O.getMap();u.flyTo([_.latitude,_.longitude],u.getMaxZoom()-1),n(20,_={})}},[r,l,o,i,d,O,k,a,c,p,K,R,B,q,h,U,z,M,Le,X,_,S,b,j,e,f,F,I,Oe,Se,je,Ie]}class yt extends re{constructor(t){super();oe(this,t,mt,it,se,{mapOptions:0,groupedObservations:24,timeSpanHistory:25,showDemoMapLayer:1,taxaHistory:2,country:3,mapCenter:20,speciesOnMapCount:21,observersOnMapCount:22,speciesList:23,project:4},null,[-1,-1])}}export{yt as default};
