import{S as lt,i as ot,s as rt,e as D,t as ie,c as I,a as T,g as ce,d as p,b as O,f as y,E as v,_ as Ee,I as De,l as z,r as fe,u as k,w as ue,x as h,k as N,j as P,n as Y,m as $,N as Ae,o as J,h as Le,v as R,a4 as nt,A as st,P as Be,U as Ze,a3 as at,Y as Ie,K as Ce}from"./vendor-83798d90.js";import{a as it}from"./index-cea82726.js";import{t as Te,M as ct,a as ft,b as ut,I as He}from"./map_species_list-74daa7d5.js";import{g as ze,i as je,r as mt,e as _t,s as pt,c as ht}from"./mapUtils-8c5a7127.js";import{s as dt,e as gt,r as bt,m as we,h as kt,i as Pe,j as vt,k as St}from"./observation_data-a20951da.js";import{M as Ct,a as wt,b as Mt,S as yt,c as Lt,R as Ot}from"./map_toggle_marker_type_button-5897e2c1.js";import{C as Ne}from"./CircleMarker-fe18eefd.js";import"./formatUtils-77b182ad.js";import"./constants-3d7024b8.js";function $e(l,r,o){const a=l.slice();return a[58]=r[o][0],a[0]=r[o][1],a}function Je(l,r,o){const a=l.slice();return a[50]=r[o],a}function Re(l,r,o){const a=l.slice();return a[53]=r[o][0],a[0]=r[o][1],a}function Ue(l,r,o){const a=l.slice();return a[50]=r[o],a}function Fe(l,r,o){const a=l.slice();return a[50]=r[o],a}function qe(l){let r,o,a,e,i,t;return{c(){r=D("span"),o=ie("*"),this.h()},l(s){r=I(s,"SPAN",{class:!0,title:!0});var n=T(r);o=ce(n,"*"),n.forEach(p),this.h()},h(){O(r,"class","text-red-600"),O(r,"title",a="Since there are over "+Oe+" observations on the map, the map uses clustered markers.")},m(s,n){y(s,r,n),v(r,o),i||(t=Ee(e=Te.call(null,r)),i=!0)},p:De,d(s){s&&p(r),i=!1,t()}}}function Ge(l){let r,o,a,e;const i=[Et,Vt],t=[];function s(n,c){return n[22]?0:1}return r=s(l),o=t[r]=i[r](l),{c(){o.c(),a=z()},l(n){o.l(n),a=z()},m(n,c){t[r].m(n,c),y(n,a,c),e=!0},p(n,c){let _=r;r=s(n),r===_?t[r].p(n,c):(fe(),k(t[_],1,1,()=>{t[_]=null}),ue(),o=t[r],o?o.p(n,c):(o=t[r]=i[r](n),o.c()),h(o,1),o.m(a.parentNode,a))},i(n){e||(h(o),e=!0)},o(n){k(o),e=!1},d(n){t[r].d(n),n&&p(a)}}}function Vt(l){let r,o,a,e,i;return o=new He({}),{c(){r=D("span"),P(o.$$.fragment),this.h()},l(t){r=I(t,"SPAN",{title:!0});var s=T(r);$(o.$$.fragment,s),s.forEach(p),this.h()},h(){O(r,"title","click show to species list")},m(t,s){y(t,r,s),J(o,r,null),a=!0,e||(i=[Ee(Te.call(null,r)),Be(r,"click",l[26])],e=!0)},p:De,i(t){a||(h(o.$$.fragment,t),a=!0)},o(t){k(o.$$.fragment,t),a=!1},d(t){t&&p(r),R(o),e=!1,Ze(i)}}}function Et(l){let r,o,a,e,i;return o=new He({}),{c(){r=D("span"),P(o.$$.fragment),this.h()},l(t){r=I(t,"SPAN",{title:!0});var s=T(r);$(o.$$.fragment,s),s.forEach(p),this.h()},h(){O(r,"title","click hide to species list")},m(t,s){y(t,r,s),J(o,r,null),a=!0,e||(i=[Ee(Te.call(null,r)),Be(r,"click",l[26])],e=!0)},p:De,i(t){a||(h(o.$$.fragment,t),a=!0)},o(t){k(o.$$.fragment,t),a=!1},d(t){t&&p(r),R(o),e=!1,Ze(i)}}}function Dt(l){let r,o,a=[...l[8]],e=[];for(let t=0;t<a.length;t+=1)e[t]=Qe($e(l,a,t));const i=t=>k(e[t],1,1,()=>{e[t]=null});return{c(){for(let t=0;t<e.length;t+=1)e[t].c();r=z()},l(t){for(let s=0;s<e.length;s+=1)e[s].l(t);r=z()},m(t,s){for(let n=0;n<e.length;n+=1)e[n].m(t,s);y(t,r,s),o=!0},p(t,s){if(s[0]&536877314){a=[...t[8]];let n;for(n=0;n<a.length;n+=1){const c=$e(t,a,n);e[n]?(e[n].p(c,s),h(e[n],1)):(e[n]=Qe(c),e[n].c(),h(e[n],1),e[n].m(r.parentNode,r))}for(fe(),n=a.length;n<e.length;n+=1)i(n);ue()}},i(t){if(!o){for(let s=0;s<a.length;s+=1)h(e[s]);o=!0}},o(t){e=e.filter(Boolean);for(let s=0;s<e.length;s+=1)k(e[s]);o=!1},d(t){Ce(e,t),t&&p(r)}}}function It(l){let r,o,a=[...l[8]],e=[];for(let t=0;t<a.length;t+=1)e[t]=Xe(Re(l,a,t));const i=t=>k(e[t],1,1,()=>{e[t]=null});return{c(){for(let t=0;t<e.length;t+=1)e[t].c();r=z()},l(t){for(let s=0;s<e.length;s+=1)e[s].l(t);r=z()},m(t,s){for(let n=0;n<e.length;n+=1)e[n].m(t,s);y(t,r,s),o=!0},p(t,s){if(s[0]&536871170){a=[...t[8]];let n;for(n=0;n<a.length;n+=1){const c=Re(t,a,n);e[n]?(e[n].p(c,s),h(e[n],1)):(e[n]=Xe(c),e[n].c(),h(e[n],1),e[n].m(r.parentNode,r))}for(fe(),n=a.length;n<e.length;n+=1)i(n);ue()}},i(t){if(!o){for(let s=0;s<a.length;s+=1)h(e[s]);o=!0}},o(t){e=e.filter(Boolean);for(let s=0;s<e.length;s+=1)k(e[s]);o=!1},d(t){Ce(e,t),t&&p(r)}}}function Tt(l){let r,o,a=l[8],e=[];for(let t=0;t<a.length;t+=1)e[t]=xe(Fe(l,a,t));const i=t=>k(e[t],1,1,()=>{e[t]=null});return{c(){for(let t=0;t<e.length;t+=1)e[t].c();r=z()},l(t){for(let s=0;s<e.length;s+=1)e[s].l(t);r=z()},m(t,s){for(let n=0;n<e.length;n+=1)e[n].m(t,s);y(t,r,s),o=!0},p(t,s){if(s[0]&536871170){a=t[8];let n;for(n=0;n<a.length;n+=1){const c=Fe(t,a,n);e[n]?(e[n].p(c,s),h(e[n],1)):(e[n]=xe(c),e[n].c(),h(e[n],1),e[n].m(r.parentNode,r))}for(fe(),n=a.length;n<e.length;n+=1)i(n);ue()}},i(t){if(!o){for(let s=0;s<a.length;s+=1)h(e[s]);o=!0}},o(t){e=e.filter(Boolean);for(let s=0;s<e.length;s+=1)k(e[s]);o=!1},d(t){Ce(e,t),t&&p(r)}}}function jt(l){let r,o;return r=new Lt({props:{items:l[8]}}),{c(){P(r.$$.fragment)},l(a){$(r.$$.fragment,a)},m(a,e){J(r,a,e),o=!0},p(a,e){const i={};e[0]&256&&(i.items=a[8]),r.$set(i)},i(a){o||(h(r.$$.fragment,a),o=!0)},o(a){k(r.$$.fragment,a),o=!1},d(a){R(r,a)}}}function Nt(l){let r,o;function a(...e){return l[41](l[50],...e)}return r=new Ot({props:{events:["click"],latLngBounds:[[l[50].latitude-l[11],l[50].longitude-l[12]],[l[50].latitude+l[11],l[50].longitude+l[12]]],color:l[1].colorSchemeMonth[l[58]]||l[1].defaultColor,fillColor:l[1].colorSchemeMonth[l[58]]||l[1].defaultColor}}),r.$on("click",a),{c(){P(r.$$.fragment)},l(e){$(r.$$.fragment,e)},m(e,i){J(r,e,i),o=!0},p(e,i){l=e;const t={};i[0]&6400&&(t.latLngBounds=[[l[50].latitude-l[11],l[50].longitude-l[12]],[l[50].latitude+l[11],l[50].longitude+l[12]]]),i[0]&258&&(t.color=l[1].colorSchemeMonth[l[58]]||l[1].defaultColor),i[0]&258&&(t.fillColor=l[1].colorSchemeMonth[l[58]]||l[1].defaultColor),r.$set(t)},i(e){o||(h(r.$$.fragment,e),o=!0)},o(e){k(r.$$.fragment,e),o=!1},d(e){R(r,e)}}}function Yt(l){let r,o;function a(...e){return l[40](l[50],...e)}return r=new Ne({props:{events:["click"],latLng:[l[50].latitude,l[50].longitude],radius:Ye,color:l[1].colorSchemeMonth[l[58]]||l[1].defaultColor,fillColor:l[1].colorSchemeMonth[l[58]]||l[1].defaultColor}}),r.$on("click",a),{c(){P(r.$$.fragment)},l(e){$(r.$$.fragment,e)},m(e,i){J(r,e,i),o=!0},p(e,i){l=e;const t={};i[0]&256&&(t.latLng=[l[50].latitude,l[50].longitude]),i[0]&258&&(t.color=l[1].colorSchemeMonth[l[58]]||l[1].defaultColor),i[0]&258&&(t.fillColor=l[1].colorSchemeMonth[l[58]]||l[1].defaultColor),r.$set(t)},i(e){o||(h(r.$$.fragment,e),o=!0)},o(e){k(r.$$.fragment,e),o=!1},d(e){R(r,e)}}}function Ke(l){let r,o,a,e,i;const t=[Yt,Nt],s=[];function n(c,_){return(r==null||_[0]&256)&&(r=!!ht.includes(c[50].month+1)),r?0:1}return o=n(l,[-1,-1,-1]),a=s[o]=t[o](l),{c(){a.c(),e=z()},l(c){a.l(c),e=z()},m(c,_){s[o].m(c,_),y(c,e,_),i=!0},p(c,_){let w=o;o=n(c,_),o===w?s[o].p(c,_):(fe(),k(s[w],1,1,()=>{s[w]=null}),ue(),a=s[o],a?a.p(c,_):(a=s[o]=t[o](c),a.c()),h(a,1),a.m(e.parentNode,e))},i(c){i||(h(a),i=!0)},o(c){k(a),i=!1},d(c){s[o].d(c),c&&p(e)}}}function Qe(l){let r,o,a=l[0],e=[];for(let t=0;t<a.length;t+=1)e[t]=Ke(Je(l,a,t));const i=t=>k(e[t],1,1,()=>{e[t]=null});return{c(){for(let t=0;t<e.length;t+=1)e[t].c();r=z()},l(t){for(let s=0;s<e.length;s+=1)e[s].l(t);r=z()},m(t,s){for(let n=0;n<e.length;n+=1)e[n].m(t,s);y(t,r,s),o=!0},p(t,s){if(s[0]&536877314){a=t[0];let n;for(n=0;n<a.length;n+=1){const c=Je(t,a,n);e[n]?(e[n].p(c,s),h(e[n],1)):(e[n]=Ke(c),e[n].c(),h(e[n],1),e[n].m(r.parentNode,r))}for(fe(),n=a.length;n<e.length;n+=1)i(n);ue()}},i(t){if(!o){for(let s=0;s<a.length;s+=1)h(e[s]);o=!0}},o(t){e=e.filter(Boolean);for(let s=0;s<e.length;s+=1)k(e[s]);o=!1},d(t){Ce(e,t),t&&p(r)}}}function We(l){let r,o;function a(...e){return l[39](l[50],...e)}return r=new Ne({props:{events:["click"],latLng:[l[50].latitude,l[50].longitude],radius:Ye,color:l[1].colorSchemeYear[we(l[53],l[1].colorSchemeYear.length)]||l[1].defaultColor,fillColor:l[1].colorSchemeYear[we(l[53],l[1].colorSchemeYear.length)]||l[1].defaultColor}}),r.$on("click",a),{c(){P(r.$$.fragment)},l(e){$(r.$$.fragment,e)},m(e,i){J(r,e,i),o=!0},p(e,i){l=e;const t={};i[0]&256&&(t.latLng=[l[50].latitude,l[50].longitude]),i[0]&258&&(t.color=l[1].colorSchemeYear[we(l[53],l[1].colorSchemeYear.length)]||l[1].defaultColor),i[0]&258&&(t.fillColor=l[1].colorSchemeYear[we(l[53],l[1].colorSchemeYear.length)]||l[1].defaultColor),r.$set(t)},i(e){o||(h(r.$$.fragment,e),o=!0)},o(e){k(r.$$.fragment,e),o=!1},d(e){R(r,e)}}}function Xe(l){let r,o,a=l[0],e=[];for(let t=0;t<a.length;t+=1)e[t]=We(Ue(l,a,t));const i=t=>k(e[t],1,1,()=>{e[t]=null});return{c(){for(let t=0;t<e.length;t+=1)e[t].c();r=z()},l(t){for(let s=0;s<e.length;s+=1)e[s].l(t);r=z()},m(t,s){for(let n=0;n<e.length;n+=1)e[n].m(t,s);y(t,r,s),o=!0},p(t,s){if(s[0]&536871170){a=t[0];let n;for(n=0;n<a.length;n+=1){const c=Ue(t,a,n);e[n]?(e[n].p(c,s),h(e[n],1)):(e[n]=We(c),e[n].c(),h(e[n],1),e[n].m(r.parentNode,r))}for(fe(),n=a.length;n<e.length;n+=1)i(n);ue()}},i(t){if(!o){for(let s=0;s<a.length;s+=1)h(e[s]);o=!0}},o(t){e=e.filter(Boolean);for(let s=0;s<e.length;s+=1)k(e[s]);o=!1},d(t){Ce(e,t),t&&p(r)}}}function xe(l){let r,o;function a(...e){return l[38](l[50],...e)}return r=new Ne({props:{events:["click"],latLng:[l[50].latitude,l[50].longitude],radius:Ye,color:l[1].defaultColor,fillColor:l[1].defaultColor}}),r.$on("click",a),{c(){P(r.$$.fragment)},l(e){$(r.$$.fragment,e)},m(e,i){J(r,e,i),o=!0},p(e,i){l=e;const t={};i[0]&256&&(t.latLng=[l[50].latitude,l[50].longitude]),i[0]&2&&(t.color=l[1].defaultColor),i[0]&2&&(t.fillColor=l[1].defaultColor),r.$set(t)},i(e){o||(h(r.$$.fragment,e),o=!0)},o(e){k(r.$$.fragment,e),o=!1},d(e){R(r,e)}}}function At(l){let r,o,a,e,i,t,s,n,c,_,w,te;r=new Ct({props:{country:l[2].country}});const U=[jt,Tt,It,Dt],j=[];function B(f,b){return f[14]?0:((a==null||b[0]&256)&&(a=!!Array.isArray(f[8])),a?1:f[1].observationsTimeSpan==="year"?2:3)}e=B(l,[-1,-1,-1]),i=j[e]=U[e](l),s=new wt({props:{map:l[4],coordinates:l[6]}});let Z={coordinates:l[6],useMarkerCluster:l[14],observationsDisplayCount:l[17],clusterLimit:Oe,userSelectedMarkerType:l[15],zoomLevel:l[10],maxZoom:l[19]};c=new Mt({props:Z}),l[42](c),c.$on("changeMarkerModeOnClick",l[24]),c.$on("changeMarkerModeAutomatic",l[25]);let F={position:"bottomleft",options:pt};return w=new yt({props:F}),l[43](w),{c(){P(r.$$.fragment),o=N(),i.c(),t=N(),P(s.$$.fragment),n=N(),P(c.$$.fragment),_=N(),P(w.$$.fragment)},l(f){$(r.$$.fragment,f),o=Y(f),i.l(f),t=Y(f),$(s.$$.fragment,f),n=Y(f),$(c.$$.fragment,f),_=Y(f),$(w.$$.fragment,f)},m(f,b){J(r,f,b),y(f,o,b),j[e].m(f,b),y(f,t,b),J(s,f,b),y(f,n,b),J(c,f,b),y(f,_,b),J(w,f,b),te=!0},p(f,b){const S={};b[0]&4&&(S.country=f[2].country),r.$set(S);let q=e;e=B(f,b),e===q?j[e].p(f,b):(fe(),k(j[q],1,1,()=>{j[q]=null}),ue(),i=j[e],i?i.p(f,b):(i=j[e]=U[e](f),i.c()),h(i,1),i.m(t.parentNode,t));const G={};b[0]&16&&(G.map=f[4]),b[0]&64&&(G.coordinates=f[6]),s.$set(G);const V={};b[0]&64&&(V.coordinates=f[6]),b[0]&16384&&(V.useMarkerCluster=f[14]),b[0]&131072&&(V.observationsDisplayCount=f[17]),b[0]&32768&&(V.userSelectedMarkerType=f[15]),b[0]&1024&&(V.zoomLevel=f[10]),b[0]&524288&&(V.maxZoom=f[19]),c.$set(V);const K={};w.$set(K)},i(f){te||(h(r.$$.fragment,f),h(i),h(s.$$.fragment,f),h(c.$$.fragment,f),h(w.$$.fragment,f),te=!0)},o(f){k(r.$$.fragment,f),k(i),k(s.$$.fragment,f),k(c.$$.fragment,f),k(w.$$.fragment,f),te=!1},d(f){R(r,f),f&&p(o),j[e].d(f),f&&p(t),R(s,f),f&&p(n),l[42](null),R(c,f),f&&p(_),l[43](null),R(w,f)}}}function Bt(l){let r,o,a,e,i,t,s,n,c,_,w,te,U,j,B,Z,F,f,b,S,q,G,V,K,ne,Q,W,he,me,de,X,x,_e,A,ge,re,be,le,oe,E=l[17]>=Oe&&qe(),M=l[23]&&Ge(l),Ve={options:l[1],$$slots:{default:[At]},$$scope:{ctx:l}};return x=new it({props:Ve}),l[44](x),A=new ct({props:{showSpeciesList:l[22],speciesList:l[9]}}),re=new ft({props:{mapOptions:l[1],selectTimeSpanHandler:l[28],groupedObservations:l[7],toggleTimeSpans:l[27],timeSpanHistory:l[5],activeTaxaCount:1}}),{c(){r=D("div"),o=D("div"),a=D("div"),e=ie("Observations"),i=N(),t=D("div"),s=ie(l[18]),n=N(),c=D("div"),_=D("div"),w=ie(`Observations on map
      `),E&&E.c(),te=N(),U=D("div"),j=ie(l[17]),B=N(),Z=D("div"),F=D("div"),f=ie("Species"),b=N(),S=D("div"),q=ie(l[20]),G=N(),V=D("div"),K=D("div"),ne=ie("Species on map"),Q=N(),W=D("div"),he=ie(l[21]),me=N(),M&&M.c(),de=N(),X=D("div"),P(x.$$.fragment),_e=N(),P(A.$$.fragment),ge=N(),P(re.$$.fragment),be=N(),le=D("div"),this.h()},l(m){r=I(m,"DIV",{class:!0});var d=T(r);o=I(d,"DIV",{class:!0});var ee=T(o);a=I(ee,"DIV",{class:!0});var pe=T(a);e=ce(pe,"Observations"),pe.forEach(p),i=Y(ee),t=I(ee,"DIV",{class:!0});var se=T(t);s=ce(se,l[18]),se.forEach(p),ee.forEach(p),n=Y(d),c=I(d,"DIV",{class:!0});var ke=T(c);_=I(ke,"DIV",{class:!0});var Se=T(_);w=ce(Se,`Observations on map
      `),E&&E.l(Se),Se.forEach(p),te=Y(ke),U=I(ke,"DIV",{class:!0});var Me=T(U);j=ce(Me,l[17]),Me.forEach(p),ke.forEach(p),B=Y(d),Z=I(d,"DIV",{class:!0});var ve=T(Z);F=I(ve,"DIV",{class:!0});var ye=T(F);f=ce(ye,"Species"),ye.forEach(p),b=Y(ve),S=I(ve,"DIV",{class:!0});var u=T(S);q=ce(u,l[20]),u.forEach(p),ve.forEach(p),G=Y(d),V=I(d,"DIV",{class:!0});var g=T(V);K=I(g,"DIV",{class:!0});var C=T(K);ne=ce(C,"Species on map"),C.forEach(p),Q=Y(g),W=I(g,"DIV",{class:!0});var H=T(W);he=ce(H,l[21]),me=Y(H),M&&M.l(H),H.forEach(p),g.forEach(p),d.forEach(p),de=Y(m),X=I(m,"DIV",{id:!0,style:!0});var ae=T(X);$(x.$$.fragment,ae),ae.forEach(p),_e=Y(m),$(A.$$.fragment,m),ge=Y(m),$(re.$$.fragment,m),be=Y(m),le=I(m,"DIV",{id:!0,class:!0}),T(le).forEach(p),this.h()},h(){O(a,"class","stat-title svelte-1scwscm"),O(t,"class","stat-value svelte-1scwscm"),O(o,"class","stat place-items-center place-content-center svelte-1scwscm"),O(_,"class","stat-title svelte-1scwscm"),O(U,"class","stat-value svelte-1scwscm"),O(c,"class","stat place-items-center place-content-center svelte-1scwscm"),O(F,"class","stat-title svelte-1scwscm"),O(S,"class","stat-value svelte-1scwscm"),O(Z,"class","stat place-items-center place-content-center svelte-1scwscm"),O(K,"class","stat-title svelte-1scwscm"),O(W,"class","stat-value svelte-1scwscm"),O(V,"class","stat place-items-center place-content-center svelte-1scwscm"),O(r,"class","w-full rounded-none border stats"),O(X,"id","taxa-map"),Ae(X,"width","100%"),Ae(X,"height","400px"),O(le,"id","observations-chart"),O(le,"class","w-full mt-4")},m(m,d){y(m,r,d),v(r,o),v(o,a),v(a,e),v(o,i),v(o,t),v(t,s),v(r,n),v(r,c),v(c,_),v(_,w),E&&E.m(_,null),v(c,te),v(c,U),v(U,j),v(r,B),v(r,Z),v(Z,F),v(F,f),v(Z,b),v(Z,S),v(S,q),v(r,G),v(r,V),v(V,K),v(K,ne),v(V,Q),v(V,W),v(W,he),v(W,me),M&&M.m(W,null),y(m,de,d),y(m,X,d),J(x,X,null),y(m,_e,d),J(A,m,d),y(m,ge,d),J(re,m,d),y(m,be,d),y(m,le,d),oe=!0},p(m,d){(!oe||d[0]&262144)&&Le(s,m[18]),m[17]>=Oe?E?E.p(m,d):(E=qe(),E.c(),E.m(_,null)):E&&(E.d(1),E=null),(!oe||d[0]&131072)&&Le(j,m[17]),(!oe||d[0]&1048576)&&Le(q,m[20]),(!oe||d[0]&2097152)&&Le(he,m[21]),m[23]?M?(M.p(m,d),d[0]&8388608&&h(M,1)):(M=Ge(m),M.c(),h(M,1),M.m(W,null)):M&&(fe(),k(M,1,1,()=>{M=null}),ue());const ee={};d[0]&2&&(ee.options=m[1]),d[0]&785750|d[2]&2&&(ee.$$scope={dirty:d,ctx:m}),x.$set(ee);const pe={};d[0]&4194304&&(pe.showSpeciesList=m[22]),d[0]&512&&(pe.speciesList=m[9]),A.$set(pe);const se={};d[0]&2&&(se.mapOptions=m[1]),d[0]&128&&(se.groupedObservations=m[7]),d[0]&32&&(se.timeSpanHistory=m[5]),re.$set(se)},i(m){oe||(h(M),h(x.$$.fragment,m),h(A.$$.fragment,m),h(re.$$.fragment,m),oe=!0)},o(m){k(M),k(x.$$.fragment,m),k(A.$$.fragment,m),k(re.$$.fragment,m),oe=!1},d(m){m&&p(r),E&&E.d(),M&&M.d(),m&&p(de),m&&p(X),l[44](null),R(x),m&&p(_e),R(A,m),m&&p(ge),R(re,m),m&&p(be),m&&p(le)}}}let Ye=8,Zt="oldest",et=.25,Oe=1e3;function Ht(l,r,o){let{observations:a}=r,{mapOptions:e}=r,{mapCenter:i}=r,{project:t}=r,{taxon:s}=r,n,c,_={},w=0,te=1,U=1,j=[],B=[],Z=[];const F=nt();let f,b=!1,S=JSON.parse(JSON.stringify(ut)),q,G=!1,V="markers",K,ne=[],Q=[],W=0,he=0,me=!1,de=0,X=0,x=0,_e=!1,A=[],ge=!1;function re(u){o(14,G=u.detail.useMarkerCluster),o(15,V=u.detail.userSelectedMarkerType),o(8,Q=le(Q))}function be(u){o(14,G=u.detail.useMarkerCluster),o(8,Q=le(Q))}function le(u){let g;if(Array.isArray(u))g=u.filter(C=>je(C,c,L));else if(G){let C=[];u.forEach((H,ae)=>{H=H.filter(tt=>je(tt,c,L)),C=C.concat(H)}),g=C}else g=new Map,u.forEach((C,H)=>{C=C.filter(ae=>je(ae,c,L)),g.set(H,C)});return g}function oe(u){o(11,te=mt(u)),o(12,U=_t(u))}function E(){o(22,_e=!_e)}function M(u){let g=u.target.dataset.filter;g=g==="unknown"?"unknown":Number(g),o(5,_[g]=!_[g],_)}function Ve(){o(5,_={})}function m(u,g){F("markerClick",{observation_id:g.id,latlng:u.detail.latlng})}function d(u){u.length>0&&c.fitBounds(u),F("doneLoading")}function ee(u){at("#observations-chart",u,{actions:!1}).then(g=>{}).catch(console.warn)}st(()=>{o(34,b=!0),o(4,c=n.getMap()),o(10,w=c.getZoom()),o(19,de=c.getMaxZoom()),oe(w),c.on("zoomend",function(){o(10,w=c.getZoom()),o(37,me=!0),oe(w)}),c.on("moveend",function(){o(37,me=!0)})});const pe=(u,g)=>m(g,u),se=(u,g)=>m(g,u),ke=(u,g)=>m(g,u),Se=(u,g)=>m(g,u);function Me(u){Ie[u?"unshift":"push"](()=>{K=u,o(16,K)})}function ve(u){Ie[u?"unshift":"push"](()=>{q=u,o(13,q)})}function ye(u){Ie[u?"unshift":"push"](()=>{n=u,o(3,n)})}return l.$$set=u=>{"observations"in u&&o(0,a=u.observations),"mapOptions"in u&&o(1,e=u.mapOptions),"mapCenter"in u&&o(30,i=u.mapCenter),"project"in u&&o(2,t=u.project),"taxon"in u&&o(31,s=u.taxon)},l.$$.update=()=>{if(l.$$.dirty[0]&1&&(o(0,a=a.filter(u=>u.latitude&&u.longitude)),o(6,j=a.map(u=>[u.latitude,u.longitude]))),l.$$.dirty[0]&163|l.$$.dirty[1]&2&&(o(32,Z=dt(a,Zt,e.observationsTimeSpan)),o(7,B=gt(Z,e.observationsTimeSpan)),e.observationsTimeSpan!=="all"&&Object.keys(_).length===0&&B.forEach((u,g)=>o(5,_[g]=!0,_))),l.$$.dirty[0]&936|l.$$.dirty[1]&97&&n&&(o(36,ne=kt(B,_)),o(18,he=Pe(ne)),o(8,Q=le(ne)),o(17,W=Pe(Q)),o(20,X=vt(ne)),o(9,A=St(Q)),o(21,x=A.length),o(23,ge=A.length>1||A.length==1&&A[0].taxon_id!==s.taxon_id),o(37,me=!1)),l.$$.dirty[0]&72&&n&&d(j),l.$$.dirty[0]&166|l.$$.dirty[1]&28)if(b&&e.observationsTimeSpan==="month"){let u=[...t.observed_months];_.unknown!==void 0&&u.push("unknown"),o(33,f=u.map(g=>({xValue:ze(g),yValue:0,opacity:0}))),B.forEach((g,C)=>{let H=u.indexOf(C),ae=C==="unknown"?e.defaultColor:e.colorSchemeMonth[C];o(33,f[H]={xValue:ze(C),yValue:g.length,color:ae,opacity:_[C]?1:et},f)}),o(35,S.layer[0].mark.width.band=1,S),o(35,S.data.values=f,S),ee(S)}else if(b&&e.observationsTimeSpan==="year"){let u=bt(t.observed_years[0],t.observed_years[1]);_.unknown!==void 0&&u.push("unknown"),o(33,f=u.map(g=>({xValue:g,yValue:0,opacity:0}))),B.forEach((g,C)=>{let H=u.indexOf(C),ae=C==="unknown"?e.defaultColor:e.colorSchemeYear[we(C,e.colorSchemeYear.length)];o(33,f[H]={xValue:C,yValue:g.length,color:ae,opacity:_[C]?1:et},f)}),Object.keys(u).length<=4?o(35,S.layer[0].mark.width.band=.6,S):o(35,S.layer[0].mark.width.band=1,S),o(35,S.data.values=f,S),ee(S)}else b&&(o(33,f=[{xValue:"All",yValue:B.length,color:e.defaultColor,opacity:1}]),o(35,S.layer[0].mark.width.band=.6,S),o(35,S.data.values=f,S),ee(S));l.$$.dirty[0]&1073741848&&n&&i&&i.longitude&&(document.getElementById("taxa-map").scrollIntoView(),c.flyTo([i.latitude,i.longitude],c.getMaxZoom()-1),o(30,i={}))},[a,e,t,n,c,_,j,B,Q,A,w,te,U,q,G,V,K,W,he,de,X,x,_e,ge,re,be,E,M,Ve,m,i,s,Z,f,b,S,ne,me,pe,se,ke,Se,Me,ve,ye]}class Kt extends lt{constructor(r){super();ot(this,r,Ht,Bt,rt,{observations:0,mapOptions:1,mapCenter:30,project:2,taxon:31},null,[-1,-1,-1])}}export{Kt as default};
