import{S as re,i as se,s as ie,D as Be,e as $,c as x,a as ee,d as y,N as te,f as w,E as Ne,F as ze,G as Ae,H as He,x as _,u as g,L as Pe,a4 as ae,ae as Re,Y as le,j as O,m as E,o as T,P as Ze,v as j,A as ve,k as G,l as H,n as V,r as P,w as R,K as J,t as Ue,g as Ge}from"./vendor-83798d90.js";import{L as fe,E as Ve,a as We}from"./index-cea82726.js";import{s as qe,i as ne}from"./mapUtils-8c5a7127.js";import{h as Fe,i as ue,j as Ke,k as Ye}from"./observation_data-a20951da.js";import{M as Je,a as Qe,b as Xe,S as $e,R as xe,c as et}from"./map_toggle_marker_type_button-5897e2c1.js";import{T as ce}from"./TileLayer-978a34f9.js";import{C as me}from"./CircleMarker-fe18eefd.js";import"./formatUtils-77b182ad.js";import"./constants-3d7024b8.js";function tt(s){let t,n,o;const e=s[5].default,i=Be(e,s,s[4],null);return{c(){t=$("div"),n=$("div"),i&&i.c(),this.h()},l(l){t=x(l,"DIV",{style:!0});var r=ee(t);n=x(r,"DIV",{});var f=ee(n);i&&i.l(f),f.forEach(y),r.forEach(y),this.h()},h(){te(t,"display","none")},m(l,r){w(l,t,r),Ne(t,n),i&&i.m(n,null),s[6](n),o=!0},p(l,[r]){i&&i.p&&(!o||r&16)&&ze(i,e,l,l[4],o?He(e,l[4],r,null):Ae(l[4]),null)},i(l){o||(_(i,l),o=!0)},o(l){g(i,l),o=!1},d(l){l&&y(t),i&&i.d(l),s[6](null)}}}function lt(s,t,n){let{$$slots:o={},$$scope:e}=t;const{getLayer:i}=Pe(fe.Layer);let{events:l=[]}=t,r,f;const p=ae();let I;Re(()=>{I.unregister()});function b(){return r}function S(k){le[k?"unshift":"push"](()=>{f=k,n(0,f)})}return s.$$set=k=>{"events"in k&&n(1,l=k.events),"$$scope"in k&&n(4,e=k.$$scope)},s.$$.update=()=>{s.$$.dirty&11&&(r||(n(3,r=fe.popup()),I=new Ve(r,p,l),i().bindPopup(r)),r.setContent(f))},[f,l,b,r,e,o,S]}class nt extends re{constructor(t){super();se(this,t,lt,tt,ie,{events:1,getPopup:2})}get getPopup(){return this.$$.ctx[2]}}function _e(s,t,n){const o=s.slice();return o[40]=t[n][0],o[41]=t[n][1],o}function pe(s,t,n){const o=s.slice();return o[37]=t[n],o}function ge(s,t,n){const o=s.slice();return o[37]=t[n],o}function he(s,t,n){const o=s.slice();return o[46]=t[n],o}function ke(s){let t,n;return t=new ce({props:{zIndex:201,url:s[46].InatTaxonRangeUrl}}),{c(){O(t.$$.fragment)},l(o){E(t.$$.fragment,o)},m(o,e){T(t,o,e),n=!0},p(o,e){const i={};e[0]&4&&(i.url=o[46].InatTaxonRangeUrl),t.$set(i)},i(o){n||(_(t.$$.fragment,o),n=!0)},o(o){g(t.$$.fragment,o),n=!1},d(o){j(t,o)}}}function be(s){let t,n;return t=new ce({props:{zIndex:201,url:s[46].InatGridUrl}}),{c(){O(t.$$.fragment)},l(o){E(t.$$.fragment,o)},m(o,e){T(t,o,e),n=!0},p(o,e){const i={};e[0]&4&&(i.url=o[46].InatGridUrl),t.$set(i)},i(o){n||(_(t.$$.fragment,o),n=!0)},o(o){g(t.$$.fragment,o),n=!1},d(o){j(t,o)}}}function de(s){let t,n,o,e=s[46].showInatTaxonRange&&ke(s),i=s[46].showInatGrid&&be(s);return{c(){e&&e.c(),t=G(),i&&i.c(),n=H()},l(l){e&&e.l(l),t=V(l),i&&i.l(l),n=H()},m(l,r){e&&e.m(l,r),w(l,t,r),i&&i.m(l,r),w(l,n,r),o=!0},p(l,r){l[46].showInatTaxonRange?e?(e.p(l,r),r[0]&4&&_(e,1)):(e=ke(l),e.c(),_(e,1),e.m(t.parentNode,t)):e&&(P(),g(e,1,1,()=>{e=null}),R()),l[46].showInatGrid?i?(i.p(l,r),r[0]&4&&_(i,1)):(i=be(l),i.c(),_(i,1),i.m(n.parentNode,n)):i&&(P(),g(i,1,1,()=>{i=null}),R())},i(l){o||(_(e),_(i),o=!0)},o(l){g(e),g(i),o=!1},d(l){e&&e.d(l),l&&y(t),i&&i.d(l),l&&y(n)}}}function ot(s){let t,n,o=[...s[6]],e=[];for(let l=0;l<o.length;l+=1)e[l]=Ce(_e(s,o,l));const i=l=>g(e[l],1,1,()=>{e[l]=null});return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=H()},l(l){for(let r=0;r<e.length;r+=1)e[r].l(l);t=H()},m(l,r){for(let f=0;f<e.length;f+=1)e[f].m(l,r);w(l,t,r),n=!0},p(l,r){if(r[0]&262208){o=[...l[6]];let f;for(f=0;f<o.length;f+=1){const p=_e(l,o,f);e[f]?(e[f].p(p,r),_(e[f],1)):(e[f]=Ce(p),e[f].c(),_(e[f],1),e[f].m(t.parentNode,t))}for(P(),f=o.length;f<e.length;f+=1)i(f);R()}},i(l){if(!n){for(let r=0;r<o.length;r+=1)_(e[r]);n=!0}},o(l){e=e.filter(Boolean);for(let r=0;r<e.length;r+=1)g(e[r]);n=!1},d(l){J(e,l),l&&y(t)}}}function rt(s){let t,n,o=s[6],e=[];for(let l=0;l<o.length;l+=1)e[l]=Me(ge(s,o,l));const i=l=>g(e[l],1,1,()=>{e[l]=null});return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=H()},l(l){for(let r=0;r<e.length;r+=1)e[r].l(l);t=H()},m(l,r){for(let f=0;f<e.length;f+=1)e[f].m(l,r);w(l,t,r),n=!0},p(l,r){if(r[0]&262208){o=l[6];let f;for(f=0;f<o.length;f+=1){const p=ge(l,o,f);e[f]?(e[f].p(p,r),_(e[f],1)):(e[f]=Me(p),e[f].c(),_(e[f],1),e[f].m(t.parentNode,t))}for(P(),f=o.length;f<e.length;f+=1)i(f);R()}},i(l){if(!n){for(let r=0;r<o.length;r+=1)_(e[r]);n=!0}},o(l){e=e.filter(Boolean);for(let r=0;r<e.length;r+=1)g(e[r]);n=!1},d(l){J(e,l),l&&y(t)}}}function st(s){let t,n;return t=new et({props:{items:s[6]}}),{c(){O(t.$$.fragment)},l(o){E(t.$$.fragment,o)},m(o,e){T(t,o,e),n=!0},p(o,e){const i={};e[0]&64&&(i.items=o[6]),t.$set(i)},i(o){n||(_(t.$$.fragment,o),n=!0)},o(o){g(t.$$.fragment,o),n=!1},d(o){j(t,o)}}}function ye(s){let t,n;function o(...e){return s[31](s[37],...e)}return t=new me({props:{events:["click"],latLng:[s[37].latitude,s[37].longitude],radius:Le,color:s[37].color,fillColor:s[37].fillColor}}),t.$on("click",o),{c(){O(t.$$.fragment)},l(e){E(t.$$.fragment,e)},m(e,i){T(t,e,i),n=!0},p(e,i){s=e;const l={};i[0]&64&&(l.latLng=[s[37].latitude,s[37].longitude]),i[0]&64&&(l.color=s[37].color),i[0]&64&&(l.fillColor=s[37].fillColor),t.$set(l)},i(e){n||(_(t.$$.fragment,e),n=!0)},o(e){g(t.$$.fragment,e),n=!1},d(e){j(t,e)}}}function Ce(s){let t,n,o=s[41],e=[];for(let l=0;l<o.length;l+=1)e[l]=ye(pe(s,o,l));const i=l=>g(e[l],1,1,()=>{e[l]=null});return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=H()},l(l){for(let r=0;r<e.length;r+=1)e[r].l(l);t=H()},m(l,r){for(let f=0;f<e.length;f+=1)e[f].m(l,r);w(l,t,r),n=!0},p(l,r){if(r[0]&262208){o=l[41];let f;for(f=0;f<o.length;f+=1){const p=pe(l,o,f);e[f]?(e[f].p(p,r),_(e[f],1)):(e[f]=ye(p),e[f].c(),_(e[f],1),e[f].m(t.parentNode,t))}for(P(),f=o.length;f<e.length;f+=1)i(f);R()}},i(l){if(!n){for(let r=0;r<o.length;r+=1)_(e[r]);n=!0}},o(l){e=e.filter(Boolean);for(let r=0;r<e.length;r+=1)g(e[r]);n=!1},d(l){J(e,l),l&&y(t)}}}function Me(s){let t,n;function o(...e){return s[30](s[37],...e)}return t=new me({props:{events:["click"],latLng:[s[37].latitude,s[37].longitude],radius:Le,color:s[37].color,fillColor:s[37].fillColor}}),t.$on("click",o),{c(){O(t.$$.fragment)},l(e){E(t.$$.fragment,e)},m(e,i){T(t,e,i),n=!0},p(e,i){s=e;const l={};i[0]&64&&(l.latLng=[s[37].latitude,s[37].longitude]),i[0]&64&&(l.color=s[37].color),i[0]&64&&(l.fillColor=s[37].fillColor),t.$set(l)},i(e){n||(_(t.$$.fragment,e),n=!0)},o(e){g(t.$$.fragment,e),n=!1},d(e){j(t,e)}}}function we(s){let t,n;return t=new xe({props:{latLngBounds:s[9],color:"#777",fillColor:"#777",$$slots:{default:[at]},$$scope:{ctx:s}}}),{c(){O(t.$$.fragment)},l(o){E(t.$$.fragment,o)},m(o,e){T(t,o,e),n=!0},p(o,e){const i={};e[0]&512&&(i.latLngBounds=o[9]),e[1]&262144&&(i.$$scope={dirty:e,ctx:o}),t.$set(i)},i(o){n||(_(t.$$.fragment,o),n=!0)},o(o){g(t.$$.fragment,o),n=!1},d(o){j(t,o)}}}function it(s){let t;return{c(){t=Ue("Demo map layer")},l(n){t=Ge(n,"Demo map layer")},m(n,o){w(n,t,o)},d(n){n&&y(t)}}}function at(s){let t,n;return t=new nt({props:{$$slots:{default:[it]},$$scope:{ctx:s}}}),{c(){O(t.$$.fragment)},l(o){E(t.$$.fragment,o)},m(o,e){T(t,o,e),n=!0},p(o,e){const i={};e[1]&262144&&(i.$$scope={dirty:e,ctx:o}),t.$set(i)},i(o){n||(_(t.$$.fragment,o),n=!0)},o(o){g(t.$$.fragment,o),n=!1},d(o){j(t,o)}}}function ft(s){let t,n,o,e,i,l,r,f,p,I,b,S,k,Z;t=new Je({props:{country:s[3]}});let C=s[2],m=[];for(let a=0;a<C.length;a+=1)m[a]=de(he(s,C,a));const v=a=>g(m[a],1,1,()=>{m[a]=null}),W=[st,rt,ot],D=[];function q(a,c){return a[10]?0:((e==null||c[0]&64)&&(e=!!Array.isArray(a[6])),e?1:2)}i=q(s,[-1,-1]),l=D[i]=W[i](s);let h=s[1]&&we(s);p=new Qe({props:{map:s[5],coordinates:s[8]}});let F={coordinates:s[8],useMarkerCluster:s[10],observationsDisplayCount:s[7],clusterLimit:ct,userSelectedMarkerType:s[11],zoomLevel:s[12],maxZoom:s[14]};return b=new Xe({props:F}),s[32](b),b.$on("changeMarkerModeOnClick",s[15]),b.$on("changeMarkerModeAutomatic",s[16]),k=new $e({props:{position:"bottomleft",options:qe}}),{c(){O(t.$$.fragment),n=G();for(let a=0;a<m.length;a+=1)m[a].c();o=G(),l.c(),r=G(),h&&h.c(),f=G(),O(p.$$.fragment),I=G(),O(b.$$.fragment),S=G(),O(k.$$.fragment)},l(a){E(t.$$.fragment,a),n=V(a);for(let c=0;c<m.length;c+=1)m[c].l(a);o=V(a),l.l(a),r=V(a),h&&h.l(a),f=V(a),E(p.$$.fragment,a),I=V(a),E(b.$$.fragment,a),S=V(a),E(k.$$.fragment,a)},m(a,c){T(t,a,c),w(a,n,c);for(let N=0;N<m.length;N+=1)m[N].m(a,c);w(a,o,c),D[i].m(a,c),w(a,r,c),h&&h.m(a,c),w(a,f,c),T(p,a,c),w(a,I,c),T(b,a,c),w(a,S,c),T(k,a,c),Z=!0},p(a,c){const N={};if(c[0]&8&&(N.country=a[3]),t.$set(N),c[0]&4){C=a[2];let d;for(d=0;d<C.length;d+=1){const Y=he(a,C,d);m[d]?(m[d].p(Y,c),_(m[d],1)):(m[d]=de(Y),m[d].c(),_(m[d],1),m[d].m(o.parentNode,o))}for(P(),d=C.length;d<m.length;d+=1)v(d);R()}let U=i;i=q(a,c),i===U?D[i].p(a,c):(P(),g(D[U],1,1,()=>{D[U]=null}),R(),l=D[i],l?l.p(a,c):(l=D[i]=W[i](a),l.c()),_(l,1),l.m(r.parentNode,r)),a[1]?h?(h.p(a,c),c[0]&2&&_(h,1)):(h=we(a),h.c(),_(h,1),h.m(f.parentNode,f)):h&&(P(),g(h,1,1,()=>{h=null}),R());const A={};c[0]&32&&(A.map=a[5]),c[0]&256&&(A.coordinates=a[8]),p.$set(A);const B={};c[0]&256&&(B.coordinates=a[8]),c[0]&1024&&(B.useMarkerCluster=a[10]),c[0]&128&&(B.observationsDisplayCount=a[7]),c[0]&2048&&(B.userSelectedMarkerType=a[11]),c[0]&4096&&(B.zoomLevel=a[12]),c[0]&16384&&(B.maxZoom=a[14]),b.$set(B)},i(a){if(!Z){_(t.$$.fragment,a);for(let c=0;c<C.length;c+=1)_(m[c]);_(l),_(h),_(p.$$.fragment,a),_(b.$$.fragment,a),_(k.$$.fragment,a),Z=!0}},o(a){g(t.$$.fragment,a),m=m.filter(Boolean);for(let c=0;c<m.length;c+=1)g(m[c]);g(l),g(h),g(p.$$.fragment,a),g(b.$$.fragment,a),g(k.$$.fragment,a),Z=!1},d(a){j(t,a),a&&y(n),J(m,a),a&&y(o),D[i].d(a),a&&y(r),h&&h.d(a),a&&y(f),j(p,a),a&&y(I),s[32](null),j(b,a),a&&y(S),j(k,a)}}}function ut(s){let t,n,o,e,i,l={options:s[0],$$slots:{default:[ft]},$$scope:{ctx:s}};return n=new We({props:l}),s[33](n),{c(){t=$("div"),O(n.$$.fragment),this.h()},l(r){t=x(r,"DIV",{style:!0});var f=ee(t);E(n.$$.fragment,f),f.forEach(y),this.h()},h(){te(t,"width","100%"),te(t,"height","80vh")},m(r,f){w(r,t,f),T(n,t,null),o=!0,e||(i=Ze(window,"resize",s[17]),e=!0)},p(r,f){const p={};f[0]&1&&(p.options=r[0]),f[0]&32750|f[1]&262144&&(p.$$scope={dirty:f,ctx:r}),n.$set(p)},i(r){o||(_(n.$$.fragment,r),o=!0)},o(r){g(n.$$.fragment,r),o=!1},d(r){r&&y(t),s[33](null),j(n),e=!1,i()}}}let Le=7,ct=1e3;function mt(s){let t=s.getBounds(),n=t.getEast(),o=t.getWest(),e=t.getNorth(),i=t.getSouth();var l=t.getEast()-t.getWest(),r=t.getNorth()-t.getSouth();return[[e-r*.3,n-l*.3],[i+r*.3,o+l*.3]]}function _t(s,t,n){let{mapOptions:o}=t,{groupedObservations:e}=t,{timeSpanHistory:i}=t,{showDemoMapLayer:l}=t,{taxaHistory:r}=t,{country:f}=t,{mapCenter:p}=t,{speciesCount:I}=t,{speciesDisplayCount:b}=t,{speciesList:S}=t,{showSpeciesListIcon:k}=t,{showSpeciesList:Z}=t,C,m,v=[],W=[[0,0],[0,0]],D=!1,q="markers",h,F,a=[],c=[],N=0,U=0,A=!1,B=0;const d=ae();function Y(u){n(10,D=u.detail.useMarkerCluster),n(11,q=u.detail.userSelectedMarkerType),n(6,c=Q(c))}function Se(u){n(10,D=u.detail.useMarkerCluster),n(6,c=Q(c))}function Q(u){let M;if(Array.isArray(u))M=u.filter(z=>ne(z,m,L));else if(D){let z=[];u.forEach((K,oe)=>{K=K.filter(je=>ne(je,m,L)),z=z.concat(K)}),M=z}else M=new Map,u.forEach((z,K)=>{z=z.filter(oe=>ne(oe,m,L)),M.set(K,z)});return M}function De(){m&&m.invalidateSize()}function X(u,M){d("markerClick",{observation_id:M.id,latlng:u.detail.latlng})}ve(()=>{n(5,m=C.getMap()),n(9,W=mt(m)),n(14,B=m.getMaxZoom()),m.on("zoomend",function(){n(12,h=m.getZoom()),n(29,A=!0)}),m.on("moveend",function(){n(29,A=!0)}),m.on("baselayerchange",function(u){n(14,B=m.getMaxZoom())})});const Ie=(u,M)=>X(M,u),Oe=(u,M)=>X(M,u);function Ee(u){le[u?"unshift":"push"](()=>{F=u,n(13,F)})}function Te(u){le[u?"unshift":"push"](()=>{C=u,n(4,C)})}return s.$$set=u=>{"mapOptions"in u&&n(0,o=u.mapOptions),"groupedObservations"in u&&n(25,e=u.groupedObservations),"timeSpanHistory"in u&&n(26,i=u.timeSpanHistory),"showDemoMapLayer"in u&&n(1,l=u.showDemoMapLayer),"taxaHistory"in u&&n(2,r=u.taxaHistory),"country"in u&&n(3,f=u.country),"mapCenter"in u&&n(19,p=u.mapCenter),"speciesCount"in u&&n(20,I=u.speciesCount),"speciesDisplayCount"in u&&n(21,b=u.speciesDisplayCount),"speciesList"in u&&n(22,S=u.speciesList),"showSpeciesListIcon"in u&&n(23,k=u.showSpeciesListIcon),"showSpeciesList"in u&&n(24,Z=u.showSpeciesList)},s.$$.update=()=>{if(s.$$.dirty[0]&1055916240&&C&&(n(27,a=Fe(e,i)),n(28,U=ue(a)),n(6,c=Q(a)),n(7,N=ue(c)),n(20,I=Ke(a)),n(22,S=Ye(c)),n(21,b=S.length),n(23,k=S.length>0),d("updateStats",{observationsSelectedCount:U,observationsDisplayCount:N,speciesCount:I,speciesDisplayCount:b,speciesList:S,showSpeciesListIcon:k}),n(29,A=!1)),s.$$.dirty[0]&33554452&&C)if(r.length>0)if(Array.isArray(e))n(8,v=e.map(u=>[u.latitude,u.longitude]));else{let u=[];n(8,v=e.forEach((M,z)=>{u=u.concat(M)})),n(8,v=u.map(M=>[M.latitude,M.longitude]))}else n(8,v=[]);if(s.$$.dirty[0]&524304&&C&&p&&p.longitude){let u=C.getMap();u.flyTo([p.latitude,p.longitude],u.getMaxZoom()-1),n(19,p={})}},[o,l,r,f,C,m,c,N,v,W,D,q,h,F,B,Y,Se,De,X,p,I,b,S,k,Z,e,i,a,U,A,Ie,Oe,Ee,Te]}class wt extends re{constructor(t){super();se(this,t,_t,ut,ie,{mapOptions:0,groupedObservations:25,timeSpanHistory:26,showDemoMapLayer:1,taxaHistory:2,country:3,mapCenter:19,speciesCount:20,speciesDisplayCount:21,speciesList:22,showSpeciesListIcon:23,showSpeciesList:24},null,[-1,-1])}}export{wt as default};
