var ce=Object.defineProperty,_e=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var W=(a,e,t)=>e in a?ce(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,q=(a,e)=>{for(var t in e||(e={}))he.call(e,t)&&W(a,t,e[t]);if(K)for(var t of K(e))ve.call(e,t)&&W(a,t,e[t]);return a},C=(a,e)=>_e(a,me(e));import{f as P}from"./formatUtils-77b182ad.js";import{s as R}from"./constants-3d7024b8.js";import{S as X,i as V,s as x,e as _,c as m,a as h,d as o,b as T,f as v,J as I,t as j,g as y,F as d,h as Z,j as B,l as Q,Q as $,k as S,N as z,Y as be}from"./vendor-ac733917.js";function Le(a){return a.map(e=>C(q({},e),{id:Number(e.id),latitude:Number(e.latitude),longitude:Number(e.longitude),taxon_id:Number(e.taxon_id),coordinates_obscured:e.coordinates_obscured==="True"}))}function Se(a){return a.map(e=>C(q({},e),{id:Number(e.id),observations_count:Number(e.observations_count),parent_id:Number(e.parent_id),taxa_count:Number(e.taxa_count),taxon_id:Number(e.taxon_id)}))}function ee(a,e){let t=new Map;return a.forEach(s=>{t.get(s[e])?t.get(s[e]).push(s):t.set(s[e],[s])}),t}function Me(a,e){return(a%e+e)%e}function Ae(a,e){return e?Array.from({length:e-a+1},(t,s)=>a+s):Array.from({length:a+1},(t,s)=>s)}function qe(a,e){function t(i){var l=parseInt(i,16);return l=parseInt(l*(100+e)/100),l=l<255?l:255,l.toString(16).length==1?"0"+l.toString(16):l.toString(16)}a=a.replace("#","");var s=t(a.substring(0,2)),r=t(a.substring(2,4)),n=t(a.substring(4,6));return s+r+n}const Ce=(a,e)=>new Promise((t,s)=>{e=e.toLowerCase();let r=[],n=[];a.forEach(i=>{i.common_name&&new RegExp("\\b"+e).test(i.common_name.toLowerCase())&&!n.includes(i.taxon_id)&&(r.push({taxon_id:Number(i.taxon_id),common_name:i.common_name,scientific_name:i.scientific_name,taxa_count:i.taxa_count,image_url:i.image_url,rank:i.rank}),n.push(i.taxon_id))}),a.forEach(i=>{i.scientific_name&&new RegExp("\\b"+e).test(i.scientific_name.toLowerCase())&&!n.includes(i.taxon_id)&&(r.push({taxon_id:Number(i.taxon_id),common_name:i.common_name,scientific_name:i.scientific_name,taxa_count:i.taxa_count,image_url:i.image_url}),n.push(i.taxon_id))}),r.sort((i,l)=>l.observations_count-i.observations_count||l.taxa_count-i.taxa_count),r=r.map(i=>C(q({},i),{label:P(i)})),t(r)}),Fe=(a,e,t)=>a.filter(r=>r.taxon_ids).filter(r=>r.taxon_ids.split("|").includes(""+e)).map(r=>{let n=r.time_observed_at&&new Date(r.time_observed_at),i=r.time_observed_at?n.getMonth():"unknown",l=r.time_observed_at?n.getFullYear():"unknown";return C(q({},r),{month:i,year:l,color:t,fillColor:t})});function pe(a,e){return new Date(e.time_observed_at)-new Date(a.time_observed_at)}function ge(a,e){return new Date(a.time_observed_at)-new Date(e.time_observed_at)}function we(a,e){return new Date(e.time_observed_at).getMonth()-new Date(a.time_observed_at).getMonth()||new Date(e.time_observed_at)-new Date(a.time_observed_at)}function De(a,e){return new Date(a.time_observed_at).getMonth()-new Date(e.time_observed_at).getMonth()||new Date(a.time_observed_at)-new Date(e.time_observed_at)}function Ie(a,e,t){let s,r=[],n=[];return a.forEach(i=>{i.time_observed_at?r.push(i):n.push(i)}),e==="oldest"?t==="month"?s=r.sort(De):s=r.sort(ge):t==="month"?s=r.sort(we):s=r.sort(pe),n.length>0&&(s=s.concat(n)),s}function ze(a,e){let t=new Map,s=[],r=[];if(a.forEach(n=>{n.time_observed_at?s.push(n):r.push(n)}),e==="month")t=ee(s.map(n=>C(q({},n),{month:new Date(n.time_observed_at).getMonth()})),"month");else if(e==="year")t=ee(s.map(n=>C(q({},n),{year:new Date(n.time_observed_at).getFullYear()})),"year");else return a;return r.length>0&&t.set("unknown",r),t}function Pe(a){if(Array.isArray(a))return new Set(a.map(e=>e.id)).size;{let e=new Set;return a.forEach((t,s)=>{t.forEach(r=>e.add(r.id))}),e.size}}function Re(a){if(Array.isArray(a))return new Set(a.filter(e=>R.includes(e.rank)).map(e=>e.taxon_id)).size;{let e=new Set;return a.forEach((t,s)=>{t.filter(r=>R.includes(r.rank)).forEach(r=>e.add(r.taxon_id))}),e.size}}function Ze(a){if(Array.isArray(a)){let e={};return a.filter(t=>R.includes(t.rank)).forEach(t=>{e[t.taxon_id]={taxon_id:t.taxon_id,name:P(t,!0)}}),Object.values(e)}else{let e={};return a.forEach((t,s)=>{t.filter(r=>R.includes(r.rank)).forEach(r=>{e[r.taxon_id]={taxon_id:r.taxon_id,name:P(r,!0)}})}),Object.values(e)}}function Be(a,e){let t;return Object.keys(e).length===0?t=[...a]:(t=new Map,a.forEach((s,r)=>{e[r]&&t.set(r,s)})),t}function Qe(a,e){return a.filter(t=>R.includes(t.rank)).filter(t=>t.observations_count>0).filter(t=>t.taxon_ids.split("|").includes(""+e.taxon_id))}function Ye(a,e){let t=a.target.dataset.filter;return t=t==="unknown"?"unknown":Number(t),e[t]=!e[t],e}function ke(a){let e;return{c(){e=_("div"),this.h()},l(t){e=m(t,"DIV",{class:!0}),h(e).forEach(o),this.h()},h(){T(e,"class","loader svelte-1q81au6")},m(t,s){v(t,e,s)},p:I,i:I,o:I,d(t){t&&o(e)}}}class Ge extends X{constructor(e){super();V(this,e,null,ke,x,{})}}function te(a){let e,t,s,r=a[0].user_login+"",n;return{c(){e=_("dt"),t=j("Observer"),s=_("dd"),n=j(r),this.h()},l(i){e=m(i,"DT",{class:!0});var l=h(e);t=y(l,"Observer"),l.forEach(o),s=m(i,"DD",{});var u=h(s);n=y(u,r),u.forEach(o),this.h()},h(){T(e,"class","svelte-1173w1j")},m(i,l){v(i,e,l),d(e,t),v(i,s,l),d(s,n)},p(i,l){l&1&&r!==(r=i[0].user_login+"")&&Z(n,r)},d(i){i&&o(e),i&&o(s)}}}function ie(a){let e,t,s,r=new Date(a[0].time_observed_at).toLocaleDateString()+"",n;return{c(){e=_("dt"),t=j("Date"),s=_("dd"),n=j(r),this.h()},l(i){e=m(i,"DT",{class:!0});var l=h(e);t=y(l,"Date"),l.forEach(o),s=m(i,"DD",{});var u=h(s);n=y(u,r),u.forEach(o),this.h()},h(){T(e,"class","svelte-1173w1j")},m(i,l){v(i,e,l),d(e,t),v(i,s,l),d(s,n)},p(i,l){l&1&&r!==(r=new Date(i[0].time_observed_at).toLocaleDateString()+"")&&Z(n,r)},d(i){i&&o(e),i&&o(s)}}}function ae(a){let e,t,s,r=a[0].quality_grade+"",n;return{c(){e=_("dt"),t=j("Quality grade"),s=_("dd"),n=j(r),this.h()},l(i){e=m(i,"DT",{class:!0});var l=h(e);t=y(l,"Quality grade"),l.forEach(o),s=m(i,"DD",{});var u=h(s);n=y(u,r),u.forEach(o),this.h()},h(){T(e,"class","svelte-1173w1j")},m(i,l){v(i,e,l),d(e,t),v(i,s,l),d(s,n)},p(i,l){l&1&&r!==(r=i[0].quality_grade+"")&&Z(n,r)},d(i){i&&o(e),i&&o(s)}}}function se(a){let e,t,s,r=a[0].license+"",n;return{c(){e=_("dt"),t=j("License"),s=_("dd"),n=j(r),this.h()},l(i){e=m(i,"DT",{class:!0});var l=h(e);t=y(l,"License"),l.forEach(o),s=m(i,"DD",{});var u=h(s);n=y(u,r),u.forEach(o),this.h()},h(){T(e,"class","svelte-1173w1j")},m(i,l){v(i,e,l),d(e,t),v(i,s,l),d(s,n)},p(i,l){l&1&&r!==(r=i[0].license+"")&&Z(n,r)},d(i){i&&o(e),i&&o(s)}}}function ne(a){let e,t,s,r=a[0].description+"",n;return{c(){e=_("dt"),t=j("Description"),s=_("dd"),n=j(r),this.h()},l(i){e=m(i,"DT",{class:!0});var l=h(e);t=y(l,"Description"),l.forEach(o),s=m(i,"DD",{});var u=h(s);n=y(u,r),u.forEach(o),this.h()},h(){T(e,"class","svelte-1173w1j")},m(i,l){v(i,e,l),d(e,t),v(i,s,l),d(s,n)},p(i,l){l&1&&r!==(r=i[0].description+"")&&Z(n,r)},d(i){i&&o(e),i&&o(s)}}}function re(a){let e,t,s,r,n=a[0].geoprivacy==="obscured"&&le(),i=a[0].taxon_geoprivacy==="obscured"&&oe();return{c(){e=_("dt"),t=j("Coordinates are obscured"),s=_("dd"),n&&n.c(),r=B(),i&&i.c(),this.h()},l(l){e=m(l,"DT",{class:!0});var u=h(e);t=y(u,"Coordinates are obscured"),u.forEach(o),s=m(l,"DD",{});var L=h(s);n&&n.l(L),r=Q(L),i&&i.l(L),L.forEach(o),this.h()},h(){T(e,"class","svelte-1173w1j")},m(l,u){v(l,e,u),d(e,t),v(l,s,u),n&&n.m(s,null),d(s,r),i&&i.m(s,null)},p(l,u){l[0].geoprivacy==="obscured"?n||(n=le(),n.c(),n.m(s,r)):n&&(n.d(1),n=null),l[0].taxon_geoprivacy==="obscured"?i||(i=oe(),i.c(),i.m(s,null)):i&&(i.d(1),i=null)},d(l){l&&o(e),l&&o(s),n&&n.d(),i&&i.d()}}}function le(a){let e;return{c(){e=j("Observer has choosen to obscure the coordinates.")},l(t){e=y(t,"Observer has choosen to obscure the coordinates.")},m(t,s){v(t,e,s)},d(t){t&&o(e)}}}function oe(a){let e;return{c(){e=j("Taxon is threatened or rare so the coordinates are obscured.")},l(t){e=y(t,"Taxon is threatened or rare so the coordinates are obscured.")},m(t,s){v(t,e,s)},d(t){t&&o(e)}}}function fe(a){let e,t,s,r;return{c(){e=_("span"),t=j("Show on map"),this.h()},l(n){e=m(n,"SPAN",{class:!0});var i=h(e);t=y(i,"Show on map"),i.forEach(o),this.h()},h(){T(e,"class","link-color mr-4 svelte-1173w1j")},m(n,i){v(n,e,i),d(e,t),s||(r=$(e,"click",a[6]),s=!0)},p:I,d(n){n&&o(e),s=!1,r()}}}function ue(a){let e,t,s,r,n;return{c(){e=_("a"),t=j("Species page"),this.h()},l(i){e=m(i,"A",{class:!0,href:!0});var l=h(e);t=y(l,"Species page"),l.forEach(o),this.h()},h(){T(e,"class","mr-4 svelte-1173w1j"),T(e,"href",s=""+(a[1]+"/taxa/"+a[0].taxon_id))},m(i,l){v(i,e,l),d(e,t),r||(n=$(e,"click",a[7]),r=!0)},p(i,l){l&3&&s!==(s=""+(i[1]+"/taxa/"+i[0].taxon_id))&&T(e,"href",s)},d(i){i&&o(e),r=!1,n()}}}function Ee(a){let e,t,s=P(a[0],!0)+"",r,n,i,l,u,L,F,N,Y,G,M,U,J,b=a[0].user_login&&te(a),p=a[0].time_observed_at&&ie(a),g=a[0].quality_grade&&ae(a),w=a[0].license&&se(a),D=a[0].description&&ne(a),k=a[0].coordinates_obscured&&re(a),E=a[3]&&fe(a),O=a[0].taxon_id!==a[4].taxon_id&&ue(a);return{c(){e=_("div"),t=_("h3"),r=B(),n=_("dl"),b&&b.c(),i=S(),p&&p.c(),l=S(),g&&g.c(),u=S(),w&&w.c(),L=S(),D&&D.c(),F=S(),k&&k.c(),N=B(),E&&E.c(),Y=B(),O&&O.c(),G=B(),M=_("a"),U=j("iNaturalist observation"),this.h()},l(f){e=m(f,"DIV",{});var c=h(e);t=m(c,"H3",{class:!0});var de=h(t);de.forEach(o),r=Q(c),n=m(c,"DL",{class:!0});var A=h(n);b&&b.l(A),i=S(),p&&p.l(A),l=S(),g&&g.l(A),u=S(),w&&w.l(A),L=S(),D&&D.l(A),F=S(),k&&k.l(A),A.forEach(o),N=Q(c),E&&E.l(c),Y=Q(c),O&&O.l(c),G=Q(c),M=m(c,"A",{class:!0,href:!0});var H=h(M);U=y(H,"iNaturalist observation"),H.forEach(o),c.forEach(o),this.h()},h(){T(t,"class","svelte-1173w1j"),z(t,"small",a[2]),T(n,"class","svelte-1173w1j"),T(M,"class","external-link svelte-1173w1j"),T(M,"href",J="https://www.inaturalist.org/observations/"+a[0].id),z(e,"prose",a[2]===!1),z(e,"p-4",!a[2])},m(f,c){v(f,e,c),d(e,t),t.innerHTML=s,d(e,r),d(e,n),b&&b.m(n,null),d(n,i),p&&p.m(n,null),d(n,l),g&&g.m(n,null),d(n,u),w&&w.m(n,null),d(n,L),D&&D.m(n,null),d(n,F),k&&k.m(n,null),d(e,N),E&&E.m(e,null),d(e,Y),O&&O.m(e,null),d(e,G),d(e,M),d(M,U)},p(f,[c]){c&1&&s!==(s=P(f[0],!0)+"")&&(t.innerHTML=s),c&4&&z(t,"small",f[2]),f[0].user_login?b?b.p(f,c):(b=te(f),b.c(),b.m(n,i)):b&&(b.d(1),b=null),f[0].time_observed_at?p?p.p(f,c):(p=ie(f),p.c(),p.m(n,l)):p&&(p.d(1),p=null),f[0].quality_grade?g?g.p(f,c):(g=ae(f),g.c(),g.m(n,u)):g&&(g.d(1),g=null),f[0].license?w?w.p(f,c):(w=se(f),w.c(),w.m(n,L)):w&&(w.d(1),w=null),f[0].description?D?D.p(f,c):(D=ne(f),D.c(),D.m(n,F)):D&&(D.d(1),D=null),f[0].coordinates_obscured?k?k.p(f,c):(k=re(f),k.c(),k.m(n,null)):k&&(k.d(1),k=null),f[3]?E?E.p(f,c):(E=fe(f),E.c(),E.m(e,Y)):E&&(E.d(1),E=null),f[0].taxon_id!==f[4].taxon_id?O?O.p(f,c):(O=ue(f),O.c(),O.m(e,G)):O&&(O.d(1),O=null),c&1&&J!==(J="https://www.inaturalist.org/observations/"+f[0].id)&&T(M,"href",J),c&4&&z(e,"prose",f[2]===!1),c&4&&z(e,"p-4",!f[2])},i:I,o:I,d(f){f&&o(e),b&&b.d(),p&&p.d(),g&&g.d(),w&&w.d(),D&&D.d(),k&&k.d(),E&&E.d(),O&&O.d()}}}function Oe(a,e,t){let{observation:s={}}=e,{projectPath:r}=e,{compactLayout:n=!1}=e,{enableZoomToObservation:i=!0}=e,{taxon:l={}}=e;const u=be();function L(){u("zoomToObservation",{observation_id:s.id,latitude:s.latitude,longitude:s.longitude})}const F=()=>u("changeTaxon",{taxon_id:s.taxon_id});return a.$$set=N=>{"observation"in N&&t(0,s=N.observation),"projectPath"in N&&t(1,r=N.projectPath),"compactLayout"in N&&t(2,n=N.compactLayout),"enableZoomToObservation"in N&&t(3,i=N.enableZoomToObservation),"taxon"in N&&t(4,l=N.taxon)},[s,r,n,i,l,u,L,F]}class Je extends X{constructor(e){super();V(this,e,Oe,Ee,x,{observation:0,projectPath:1,compactLayout:2,enableZoomToObservation:3,taxon:4})}}export{Ge as L,Je as O,Le as a,Ce as b,Fe as c,ze as d,Be as e,Se as f,Qe as g,Pe as h,Re as i,Ze as j,qe as l,Me as m,Ae as r,Ie as s,Ye as u};
