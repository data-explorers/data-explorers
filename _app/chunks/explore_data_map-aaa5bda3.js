import{S as oe,i as re,s as se,E as Te,e as X,c as $,a as x,d as y,O as ee,f as w,F as je,G as Be,H as Ne,I as ve,p as m,n as p,M as ze,Y as ae,ag as Ae,a2 as te,v as I,w as E,x as T,Q as He,A as j,u as Pe,j as U,k as H,l as G,m as P,o as R,L as J,t as Re,g as Ze}from"./vendor-ac733917.js";import{L as ie,E as Ue,a as Ge}from"./index-0ee43062.js";import{s as Ve,i as le}from"./mapUtils-e9636914.js";import{e as We,h as fe,i as qe,j as Fe}from"./observation_data-90cf8ccf.js";import{M as Qe,a as Ye,b as Je,S as Ke,R as Xe,c as $e}from"./map_toggle_marker_type_button-8e34cd5a.js";import{T as ue}from"./TileLayer-dc3005ae.js";import{C as ce}from"./CircleMarker-a705a7f9.js";import"./formatUtils-77b182ad.js";import"./constants-3d7024b8.js";function xe(s){let t,n,o;const e=s[5].default,a=Te(e,s,s[4],null);return{c(){t=X("div"),n=X("div"),a&&a.c(),this.h()},l(l){t=$(l,"DIV",{style:!0});var r=x(t);n=$(r,"DIV",{});var f=x(n);a&&a.l(f),f.forEach(y),r.forEach(y),this.h()},h(){ee(t,"display","none")},m(l,r){w(l,t,r),je(t,n),a&&a.m(n,null),s[6](n),o=!0},p(l,[r]){a&&a.p&&(!o||r&16)&&Be(a,e,l,l[4],o?ve(e,l[4],r,null):Ne(l[4]),null)},i(l){o||(m(a,l),o=!0)},o(l){p(a,l),o=!1},d(l){l&&y(t),a&&a.d(l),s[6](null)}}}function et(s,t,n){let{$$slots:o={},$$scope:e}=t;const{getLayer:a}=ze(ie.Layer);let{events:l=[]}=t,r,f;const _=ae();let O;Ae(()=>{O.unregister()});function d(){return r}function D(k){te[k?"unshift":"push"](()=>{f=k,n(0,f)})}return s.$$set=k=>{"events"in k&&n(1,l=k.events),"$$scope"in k&&n(4,e=k.$$scope)},s.$$.update=()=>{s.$$.dirty&11&&(r||(n(3,r=ie.popup()),O=new Ue(r,_,l),a().bindPopup(r)),r.setContent(f))},[f,l,d,r,e,o,D]}class tt extends oe{constructor(t){super();re(this,t,et,xe,se,{events:1,getPopup:2})}get getPopup(){return this.$$.ctx[2]}}function me(s,t,n){const o=s.slice();return o[37]=t[n][0],o[38]=t[n][1],o}function _e(s,t,n){const o=s.slice();return o[34]=t[n],o}function pe(s,t,n){const o=s.slice();return o[34]=t[n],o}function ge(s,t,n){const o=s.slice();return o[43]=t[n],o}function he(s){let t,n;return t=new ue({props:{zIndex:201,url:s[43].InatTaxonRangeUrl}}),{c(){I(t.$$.fragment)},l(o){E(t.$$.fragment,o)},m(o,e){T(t,o,e),n=!0},p(o,e){const a={};e[0]&4&&(a.url=o[43].InatTaxonRangeUrl),t.$set(a)},i(o){n||(m(t.$$.fragment,o),n=!0)},o(o){p(t.$$.fragment,o),n=!1},d(o){j(t,o)}}}function ke(s){let t,n;return t=new ue({props:{zIndex:201,url:s[43].InatGridUrl}}),{c(){I(t.$$.fragment)},l(o){E(t.$$.fragment,o)},m(o,e){T(t,o,e),n=!0},p(o,e){const a={};e[0]&4&&(a.url=o[43].InatGridUrl),t.$set(a)},i(o){n||(m(t.$$.fragment,o),n=!0)},o(o){p(t.$$.fragment,o),n=!1},d(o){j(t,o)}}}function be(s){let t,n,o,e=s[43].showInatTaxonRange&&he(s),a=s[43].showInatGrid&&ke(s);return{c(){e&&e.c(),t=U(),a&&a.c(),n=H()},l(l){e&&e.l(l),t=G(l),a&&a.l(l),n=H()},m(l,r){e&&e.m(l,r),w(l,t,r),a&&a.m(l,r),w(l,n,r),o=!0},p(l,r){l[43].showInatTaxonRange?e?(e.p(l,r),r[0]&4&&m(e,1)):(e=he(l),e.c(),m(e,1),e.m(t.parentNode,t)):e&&(P(),p(e,1,1,()=>{e=null}),R()),l[43].showInatGrid?a?(a.p(l,r),r[0]&4&&m(a,1)):(a=ke(l),a.c(),m(a,1),a.m(n.parentNode,n)):a&&(P(),p(a,1,1,()=>{a=null}),R())},i(l){o||(m(e),m(a),o=!0)},o(l){p(e),p(a),o=!1},d(l){e&&e.d(l),l&&y(t),a&&a.d(l),l&&y(n)}}}function lt(s){let t,n,o=[...s[6]],e=[];for(let l=0;l<o.length;l+=1)e[l]=Me(me(s,o,l));const a=l=>p(e[l],1,1,()=>{e[l]=null});return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=H()},l(l){for(let r=0;r<e.length;r+=1)e[r].l(l);t=H()},m(l,r){for(let f=0;f<e.length;f+=1)e[f].m(l,r);w(l,t,r),n=!0},p(l,r){if(r[0]&262208){o=[...l[6]];let f;for(f=0;f<o.length;f+=1){const _=me(l,o,f);e[f]?(e[f].p(_,r),m(e[f],1)):(e[f]=Me(_),e[f].c(),m(e[f],1),e[f].m(t.parentNode,t))}for(P(),f=o.length;f<e.length;f+=1)a(f);R()}},i(l){if(!n){for(let r=0;r<o.length;r+=1)m(e[r]);n=!0}},o(l){e=e.filter(Boolean);for(let r=0;r<e.length;r+=1)p(e[r]);n=!1},d(l){J(e,l),l&&y(t)}}}function nt(s){let t,n,o=s[6],e=[];for(let l=0;l<o.length;l+=1)e[l]=ye(pe(s,o,l));const a=l=>p(e[l],1,1,()=>{e[l]=null});return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=H()},l(l){for(let r=0;r<e.length;r+=1)e[r].l(l);t=H()},m(l,r){for(let f=0;f<e.length;f+=1)e[f].m(l,r);w(l,t,r),n=!0},p(l,r){if(r[0]&262208){o=l[6];let f;for(f=0;f<o.length;f+=1){const _=pe(l,o,f);e[f]?(e[f].p(_,r),m(e[f],1)):(e[f]=ye(_),e[f].c(),m(e[f],1),e[f].m(t.parentNode,t))}for(P(),f=o.length;f<e.length;f+=1)a(f);R()}},i(l){if(!n){for(let r=0;r<o.length;r+=1)m(e[r]);n=!0}},o(l){e=e.filter(Boolean);for(let r=0;r<e.length;r+=1)p(e[r]);n=!1},d(l){J(e,l),l&&y(t)}}}function ot(s){let t,n;return t=new $e({props:{items:s[6]}}),{c(){I(t.$$.fragment)},l(o){E(t.$$.fragment,o)},m(o,e){T(t,o,e),n=!0},p(o,e){const a={};e[0]&64&&(a.items=o[6]),t.$set(a)},i(o){n||(m(t.$$.fragment,o),n=!0)},o(o){p(t.$$.fragment,o),n=!1},d(o){j(t,o)}}}function de(s){let t,n;function o(...e){return s[29](s[34],...e)}return t=new ce({props:{events:["click"],latLng:[s[34].latitude,s[34].longitude],radius:we,color:s[34].color,fillColor:s[34].fillColor}}),t.$on("click",o),{c(){I(t.$$.fragment)},l(e){E(t.$$.fragment,e)},m(e,a){T(t,e,a),n=!0},p(e,a){s=e;const l={};a[0]&64&&(l.latLng=[s[34].latitude,s[34].longitude]),a[0]&64&&(l.color=s[34].color),a[0]&64&&(l.fillColor=s[34].fillColor),t.$set(l)},i(e){n||(m(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){j(t,e)}}}function Me(s){let t,n,o=s[38],e=[];for(let l=0;l<o.length;l+=1)e[l]=de(_e(s,o,l));const a=l=>p(e[l],1,1,()=>{e[l]=null});return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=H()},l(l){for(let r=0;r<e.length;r+=1)e[r].l(l);t=H()},m(l,r){for(let f=0;f<e.length;f+=1)e[f].m(l,r);w(l,t,r),n=!0},p(l,r){if(r[0]&262208){o=l[38];let f;for(f=0;f<o.length;f+=1){const _=_e(l,o,f);e[f]?(e[f].p(_,r),m(e[f],1)):(e[f]=de(_),e[f].c(),m(e[f],1),e[f].m(t.parentNode,t))}for(P(),f=o.length;f<e.length;f+=1)a(f);R()}},i(l){if(!n){for(let r=0;r<o.length;r+=1)m(e[r]);n=!0}},o(l){e=e.filter(Boolean);for(let r=0;r<e.length;r+=1)p(e[r]);n=!1},d(l){J(e,l),l&&y(t)}}}function ye(s){let t,n;function o(...e){return s[28](s[34],...e)}return t=new ce({props:{events:["click"],latLng:[s[34].latitude,s[34].longitude],radius:we,color:s[34].color,fillColor:s[34].fillColor}}),t.$on("click",o),{c(){I(t.$$.fragment)},l(e){E(t.$$.fragment,e)},m(e,a){T(t,e,a),n=!0},p(e,a){s=e;const l={};a[0]&64&&(l.latLng=[s[34].latitude,s[34].longitude]),a[0]&64&&(l.color=s[34].color),a[0]&64&&(l.fillColor=s[34].fillColor),t.$set(l)},i(e){n||(m(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){j(t,e)}}}function Ce(s){let t,n;return t=new Xe({props:{latLngBounds:s[9],color:"#777",fillColor:"#777",$$slots:{default:[st]},$$scope:{ctx:s}}}),{c(){I(t.$$.fragment)},l(o){E(t.$$.fragment,o)},m(o,e){T(t,o,e),n=!0},p(o,e){const a={};e[0]&512&&(a.latLngBounds=o[9]),e[1]&32768&&(a.$$scope={dirty:e,ctx:o}),t.$set(a)},i(o){n||(m(t.$$.fragment,o),n=!0)},o(o){p(t.$$.fragment,o),n=!1},d(o){j(t,o)}}}function rt(s){let t;return{c(){t=Re("Demo map layer")},l(n){t=Ze(n,"Demo map layer")},m(n,o){w(n,t,o)},d(n){n&&y(t)}}}function st(s){let t,n;return t=new tt({props:{$$slots:{default:[rt]},$$scope:{ctx:s}}}),{c(){I(t.$$.fragment)},l(o){E(t.$$.fragment,o)},m(o,e){T(t,o,e),n=!0},p(o,e){const a={};e[1]&32768&&(a.$$scope={dirty:e,ctx:o}),t.$set(a)},i(o){n||(m(t.$$.fragment,o),n=!0)},o(o){p(t.$$.fragment,o),n=!1},d(o){j(t,o)}}}function at(s){let t,n,o,e,a,l,r,f,_,O,d,D,k,b;t=new Qe({props:{country:s[3]}});let S=s[2],g=[];for(let i=0;i<S.length;i+=1)g[i]=be(ge(s,S,i));const V=i=>p(g[i],1,1,()=>{g[i]=null}),Q=[ot,nt,lt],B=[];function W(i,c){return c[0]&64&&(e=null),i[10]?0:(e==null&&(e=!!Array.isArray(i[6])),e?1:2)}a=W(s,[-1,-1]),l=B[a]=Q[a](s);let h=s[1]&&Ce(s);_=new Ye({props:{map:s[5],coordinates:s[8]}});let N={coordinates:s[8],useMarkerCluster:s[10],observationsOnMapCount:s[7],clusterLimit:ft,userSelectedMarkerType:s[11],zoomLevel:s[12],maxZoom:s[14]};return d=new Je({props:N}),s[30](d),d.$on("changeMarkerModeOnClick",s[15]),d.$on("changeMarkerModeAutomatic",s[16]),k=new Ke({props:{position:"bottomleft",options:Ve}}),{c(){I(t.$$.fragment),n=U();for(let i=0;i<g.length;i+=1)g[i].c();o=U(),l.c(),r=U(),h&&h.c(),f=U(),I(_.$$.fragment),O=U(),I(d.$$.fragment),D=U(),I(k.$$.fragment)},l(i){E(t.$$.fragment,i),n=G(i);for(let c=0;c<g.length;c+=1)g[c].l(i);o=G(i),l.l(i),r=G(i),h&&h.l(i),f=G(i),E(_.$$.fragment,i),O=G(i),E(d.$$.fragment,i),D=G(i),E(k.$$.fragment,i)},m(i,c){T(t,i,c),w(i,n,c);for(let v=0;v<g.length;v+=1)g[v].m(i,c);w(i,o,c),B[a].m(i,c),w(i,r,c),h&&h.m(i,c),w(i,f,c),T(_,i,c),w(i,O,c),T(d,i,c),w(i,D,c),T(k,i,c),b=!0},p(i,c){const v={};if(c[0]&8&&(v.country=i[3]),t.$set(v),c[0]&4){S=i[2];let M;for(M=0;M<S.length;M+=1){const F=ge(i,S,M);g[M]?(g[M].p(F,c),m(g[M],1)):(g[M]=be(F),g[M].c(),m(g[M],1),g[M].m(o.parentNode,o))}for(P(),M=S.length;M<g.length;M+=1)V(M);R()}let Z=a;a=W(i,c),a===Z?B[a].p(i,c):(P(),p(B[Z],1,1,()=>{B[Z]=null}),R(),l=B[a],l?l.p(i,c):(l=B[a]=Q[a](i),l.c()),m(l,1),l.m(r.parentNode,r)),i[1]?h?(h.p(i,c),c[0]&2&&m(h,1)):(h=Ce(i),h.c(),m(h,1),h.m(f.parentNode,f)):h&&(P(),p(h,1,1,()=>{h=null}),R());const q={};c[0]&32&&(q.map=i[5]),c[0]&256&&(q.coordinates=i[8]),_.$set(q);const A={};c[0]&256&&(A.coordinates=i[8]),c[0]&1024&&(A.useMarkerCluster=i[10]),c[0]&128&&(A.observationsOnMapCount=i[7]),c[0]&2048&&(A.userSelectedMarkerType=i[11]),c[0]&4096&&(A.zoomLevel=i[12]),c[0]&16384&&(A.maxZoom=i[14]),d.$set(A)},i(i){if(!b){m(t.$$.fragment,i);for(let c=0;c<S.length;c+=1)m(g[c]);m(l),m(h),m(_.$$.fragment,i),m(d.$$.fragment,i),m(k.$$.fragment,i),b=!0}},o(i){p(t.$$.fragment,i),g=g.filter(Boolean);for(let c=0;c<g.length;c+=1)p(g[c]);p(l),p(h),p(_.$$.fragment,i),p(d.$$.fragment,i),p(k.$$.fragment,i),b=!1},d(i){j(t,i),i&&y(n),J(g,i),i&&y(o),B[a].d(i),i&&y(r),h&&h.d(i),i&&y(f),j(_,i),i&&y(O),s[30](null),j(d,i),i&&y(D),j(k,i)}}}function it(s){let t,n,o,e,a,l={options:s[0],$$slots:{default:[at]},$$scope:{ctx:s}};return n=new Ge({props:l}),s[31](n),{c(){t=X("div"),I(n.$$.fragment),this.h()},l(r){t=$(r,"DIV",{style:!0});var f=x(t);E(n.$$.fragment,f),f.forEach(y),this.h()},h(){ee(t,"width","100%"),ee(t,"height","70vh")},m(r,f){w(r,t,f),T(n,t,null),o=!0,e||(a=He(window,"resize",s[17]),e=!0)},p(r,f){const _={};f[0]&1&&(_.options=r[0]),f[0]&32750|f[1]&32768&&(_.$$scope={dirty:f,ctx:r}),n.$set(_)},i(r){o||(m(n.$$.fragment,r),o=!0)},o(r){p(n.$$.fragment,r),o=!1},d(r){r&&y(t),s[31](null),j(n),e=!1,a()}}}let we=7,ft=1e3;function ut(s){let t=s.getBounds(),n=t.getEast(),o=t.getWest(),e=t.getNorth(),a=t.getSouth();var l=t.getEast()-t.getWest(),r=t.getNorth()-t.getSouth();return[[e-r*.3,n-l*.3],[a+r*.3,o+l*.3]]}function ct(s,t,n){let{mapOptions:o}=t,{groupedObservations:e}=t,{timeSpanHistory:a}=t,{showDemoMapLayer:l}=t,{taxaHistory:r}=t,{country:f}=t,{mapCenter:_}=t,{speciesCount:O}=t,{speciesDisplayCount:d}=t,{speciesList:D}=t,k,b,S=[],g=[[0,0],[0,0]],V=!1,Q="markers",B,W,h=[],N=[],i=0,c=0,v=!1,Z=0;const q=ae();function A(u){n(10,V=u.detail.useMarkerCluster),n(11,Q=u.detail.userSelectedMarkerType),n(6,N=F(N))}function M(u){n(10,V=u.detail.useMarkerCluster),n(6,N=F(N))}function F(u){let C;if(Array.isArray(u))C=u.filter(z=>le(z,b,L));else if(V){let z=[];u.forEach((Y,ne)=>{Y=Y.filter(Ee=>le(Ee,b,L)),z=z.concat(Y)}),C=z}else C=new Map,u.forEach((z,Y)=>{z=z.filter(ne=>le(ne,b,L)),C.set(Y,z)});return C}function Le(){b&&b.invalidateSize()}function K(u,C){q("markerClick",{observation_id:C.id,latlng:u.detail.latlng})}Pe(()=>{n(5,b=k.getMap()),n(9,g=ut(b)),n(14,Z=b.getMaxZoom()),b.on("zoomend",function(){n(12,B=b.getZoom()),n(27,v=!0)}),b.on("moveend",function(){n(27,v=!0)}),b.on("baselayerchange",function(u){n(14,Z=b.getMaxZoom())})});const Se=(u,C)=>K(C,u),Oe=(u,C)=>K(C,u);function De(u){te[u?"unshift":"push"](()=>{W=u,n(13,W)})}function Ie(u){te[u?"unshift":"push"](()=>{k=u,n(4,k)})}return s.$$set=u=>{"mapOptions"in u&&n(0,o=u.mapOptions),"groupedObservations"in u&&n(23,e=u.groupedObservations),"timeSpanHistory"in u&&n(24,a=u.timeSpanHistory),"showDemoMapLayer"in u&&n(1,l=u.showDemoMapLayer),"taxaHistory"in u&&n(2,r=u.taxaHistory),"country"in u&&n(3,f=u.country),"mapCenter"in u&&n(19,_=u.mapCenter),"speciesCount"in u&&n(20,O=u.speciesCount),"speciesDisplayCount"in u&&n(21,d=u.speciesDisplayCount),"speciesList"in u&&n(22,D=u.speciesList)},s.$$.update=()=>{if(s.$$.dirty[0]&267387088&&k&&(n(25,h=We(e,a)),n(26,c=fe(h)),n(6,N=F(h)),n(7,i=fe(N)),n(20,O=qe(h)),n(22,D=Fe(N)),n(21,d=D.length),q("updateStats",{observationsSelectedCount:c,observationsOnMapCount:i,speciesCount:O,speciesDisplayCount:d,speciesList:D,observationsOnMap:N}),n(27,v=!1)),s.$$.dirty[0]&8388628&&k)if(r.length>0)if(Array.isArray(e))n(8,S=e.map(u=>[u.latitude,u.longitude]));else{let u=[];n(8,S=e.forEach((C,z)=>{u=u.concat(C)})),n(8,S=u.map(C=>[C.latitude,C.longitude]))}else n(8,S=[]);if(s.$$.dirty[0]&524304&&k&&_&&_.longitude){let u=k.getMap();u.flyTo([_.latitude,_.longitude],u.getMaxZoom()-1),n(19,_={})}},[o,l,r,f,k,b,N,i,S,g,V,Q,B,W,Z,A,M,Le,K,_,O,d,D,e,a,h,c,v,Se,Oe,De,Ie]}class yt extends oe{constructor(t){super();re(this,t,ct,it,se,{mapOptions:0,groupedObservations:23,timeSpanHistory:24,showDemoMapLayer:1,taxaHistory:2,country:3,mapCenter:19,speciesCount:20,speciesDisplayCount:21,speciesList:22},null,[-1,-1])}}export{yt as default};
