var ce=Object.defineProperty,_e=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var K=(a,e,t)=>e in a?ce(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,q=(a,e)=>{for(var t in e||(e={}))he.call(e,t)&&K(a,t,e[t]);if(J)for(var t of J(e))ve.call(e,t)&&K(a,t,e[t]);return a},I=(a,e)=>_e(a,me(e));import{f as z}from"./formatUtils-77b182ad.js";import{s as R}from"./constants-3d7024b8.js";import{S as W,i as V,s as x,e as _,c as m,a as h,d as o,b as y,f as v,I as F,t as T,g as N,E as d,h as Z,k as B,n as Q,P as $,l as M,M as P,X as be}from"./vendor-a1a75673.js";function Se(a){return a.map(e=>I(q({},e),{id:Number(e.id),latitude:Number(e.latitude),longitude:Number(e.longitude),taxon_id:Number(e.taxon_id),coordinates_obscured:e.coordinates_obscured==="True"}))}function Me(a){return a.map(e=>I(q({},e),{id:Number(e.id),observations_count:Number(e.observations_count),parent_id:Number(e.parent_id),taxa_count:Number(e.taxa_count),taxon_id:Number(e.taxon_id)}))}function ee(a,e){let t=new Map;return a.forEach(n=>{t.get(n[e])?t.get(n[e]).push(n):t.set(n[e],[n])}),t}function Ae(a,e){return(a%e+e)%e}function je(a,e){return e?Array.from({length:e-a+1},(t,n)=>a+n):Array.from({length:a+1},(t,n)=>n)}function qe(a,e){function t(i){var l=parseInt(i,16);return l=parseInt(l*(100+e)/100),l=l<255?l:255,l.toString(16).length==1?"0"+l.toString(16):l.toString(16)}a=a.replace("#","");var n=t(a.substring(0,2)),r=t(a.substring(2,4)),s=t(a.substring(4,6));return n+r+s}const Ie=(a,e)=>new Promise((t,n)=>{e=e.toLowerCase();let r=[],s=[];a.forEach(i=>{i.common_name&&new RegExp("\\b"+e).test(i.common_name.toLowerCase())&&!s.includes(i.taxon_id)&&(r.push({taxon_id:Number(i.taxon_id),common_name:i.common_name,scientific_name:i.scientific_name,taxa_count:i.taxa_count,image_url:i.image_url,rank:i.rank}),s.push(i.taxon_id))}),a.forEach(i=>{i.scientific_name&&new RegExp("\\b"+e).test(i.scientific_name.toLowerCase())&&!s.includes(i.taxon_id)&&(r.push({taxon_id:Number(i.taxon_id),common_name:i.common_name,scientific_name:i.scientific_name,taxa_count:i.taxa_count,image_url:i.image_url}),s.push(i.taxon_id))}),r.sort((i,l)=>l.observations_count-i.observations_count||l.taxa_count-i.taxa_count),r=r.map(i=>I(q({},i),{label:z(i)})),t(r)}),Ce=(a,e,t)=>a.filter(r=>r.taxon_ids).filter(r=>r.taxon_ids.split("|").includes(""+e)).map(r=>{let s=r.time_observed_at&&new Date(r.time_observed_at),i=r.time_observed_at?s.getMonth():"unknown",l=r.time_observed_at?s.getFullYear():"unknown";return I(q({},r),{month:i,year:l,color:t,fillColor:t})});function pe(a,e){return new Date(e.time_observed_at)-new Date(a.time_observed_at)}function ge(a,e){return new Date(a.time_observed_at)-new Date(e.time_observed_at)}function De(a,e){return new Date(e.time_observed_at).getMonth()-new Date(a.time_observed_at).getMonth()||new Date(e.time_observed_at)-new Date(a.time_observed_at)}function we(a,e){return new Date(a.time_observed_at).getMonth()-new Date(e.time_observed_at).getMonth()||new Date(a.time_observed_at)-new Date(e.time_observed_at)}function Fe(a,e,t){let n,r=[],s=[];return a.forEach(i=>{i.time_observed_at?r.push(i):s.push(i)}),e==="oldest"?t==="month"?n=r.sort(we):n=r.sort(ge):t==="month"?n=r.sort(De):n=r.sort(pe),s.length>0&&(n=n.concat(s)),n}function Pe(a,e){let t=new Map,n=[],r=[];if(a.forEach(s=>{s.time_observed_at?n.push(s):r.push(s)}),e==="month")t=ee(n.map(s=>I(q({},s),{month:new Date(s.time_observed_at).getMonth()})),"month");else if(e==="year")t=ee(n.map(s=>I(q({},s),{year:new Date(s.time_observed_at).getFullYear()})),"year");else return a;return r.length>0&&t.set("unknown",r),t}function ze(a){if(Array.isArray(a))return new Set(a.map(e=>e.id)).size;{let e=new Set;return a.forEach((t,n)=>{t.forEach(r=>e.add(r.id))}),e.size}}function Re(a){if(Array.isArray(a))return new Set(a.filter(e=>R.includes(e.rank)).map(e=>e.taxon_id)).size;{let e=new Set;return a.forEach((t,n)=>{t.filter(r=>R.includes(r.rank)).forEach(r=>e.add(r.taxon_id))}),e.size}}function Ze(a){if(Array.isArray(a)){let e={};return a.filter(t=>R.includes(t.rank)).forEach(t=>{e[t.taxon_id]={taxon_id:t.taxon_id,name:z(t,!0)}}),Object.values(e)}else{let e={};return a.forEach((t,n)=>{t.filter(r=>R.includes(r.rank)).forEach(r=>{e[r.taxon_id]={taxon_id:r.taxon_id,name:z(r,!0)}})}),Object.values(e)}}function Be(a,e){let t;return Object.keys(e).length===0?t=[...a]:(t=new Map,a.forEach((n,r)=>{e[r]&&t.set(r,n)})),t}function Qe(a,e){return a.filter(t=>R.includes(t.rank)).filter(t=>t.observations_count>0).filter(t=>t.taxon_ids.split("|").includes(""+e.taxon_id))}function Ye(a,e){let t=a.target.dataset.filter;return t=t==="unknown"?"unknown":Number(t),e[t]=!e[t],e}function ke(a){let e;return{c(){e=_("div"),this.h()},l(t){e=m(t,"DIV",{class:!0}),h(e).forEach(o),this.h()},h(){y(e,"class","loader svelte-6yw1ai")},m(t,n){v(t,e,n)},p:F,i:F,o:F,d(t){t&&o(e)}}}class Ge extends W{constructor(e){super();V(this,e,null,ke,x,{})}}function te(a){let e,t,n,r=a[0].user_login+"",s;return{c(){e=_("dt"),t=T("Observer"),n=_("dd"),s=T(r),this.h()},l(i){e=m(i,"DT",{class:!0});var l=h(e);t=N(l,"Observer"),l.forEach(o),n=m(i,"DD",{});var u=h(n);s=N(u,r),u.forEach(o),this.h()},h(){y(e,"class","svelte-ny267m")},m(i,l){v(i,e,l),d(e,t),v(i,n,l),d(n,s)},p(i,l){l&1&&r!==(r=i[0].user_login+"")&&Z(s,r)},d(i){i&&o(e),i&&o(n)}}}function ie(a){let e,t,n,r=new Date(a[0].time_observed_at).toLocaleDateString()+"",s;return{c(){e=_("dt"),t=T("Date"),n=_("dd"),s=T(r),this.h()},l(i){e=m(i,"DT",{class:!0});var l=h(e);t=N(l,"Date"),l.forEach(o),n=m(i,"DD",{});var u=h(n);s=N(u,r),u.forEach(o),this.h()},h(){y(e,"class","svelte-ny267m")},m(i,l){v(i,e,l),d(e,t),v(i,n,l),d(n,s)},p(i,l){l&1&&r!==(r=new Date(i[0].time_observed_at).toLocaleDateString()+"")&&Z(s,r)},d(i){i&&o(e),i&&o(n)}}}function ae(a){let e,t,n,r=a[0].quality_grade+"",s;return{c(){e=_("dt"),t=T("Quality grade"),n=_("dd"),s=T(r),this.h()},l(i){e=m(i,"DT",{class:!0});var l=h(e);t=N(l,"Quality grade"),l.forEach(o),n=m(i,"DD",{});var u=h(n);s=N(u,r),u.forEach(o),this.h()},h(){y(e,"class","svelte-ny267m")},m(i,l){v(i,e,l),d(e,t),v(i,n,l),d(n,s)},p(i,l){l&1&&r!==(r=i[0].quality_grade+"")&&Z(s,r)},d(i){i&&o(e),i&&o(n)}}}function ne(a){let e,t,n,r=a[0].license+"",s;return{c(){e=_("dt"),t=T("License"),n=_("dd"),s=T(r),this.h()},l(i){e=m(i,"DT",{class:!0});var l=h(e);t=N(l,"License"),l.forEach(o),n=m(i,"DD",{});var u=h(n);s=N(u,r),u.forEach(o),this.h()},h(){y(e,"class","svelte-ny267m")},m(i,l){v(i,e,l),d(e,t),v(i,n,l),d(n,s)},p(i,l){l&1&&r!==(r=i[0].license+"")&&Z(s,r)},d(i){i&&o(e),i&&o(n)}}}function se(a){let e,t,n,r=a[0].description+"",s;return{c(){e=_("dt"),t=T("Description"),n=_("dd"),s=T(r),this.h()},l(i){e=m(i,"DT",{class:!0});var l=h(e);t=N(l,"Description"),l.forEach(o),n=m(i,"DD",{});var u=h(n);s=N(u,r),u.forEach(o),this.h()},h(){y(e,"class","svelte-ny267m")},m(i,l){v(i,e,l),d(e,t),v(i,n,l),d(n,s)},p(i,l){l&1&&r!==(r=i[0].description+"")&&Z(s,r)},d(i){i&&o(e),i&&o(n)}}}function re(a){let e,t,n,r,s=a[0].geoprivacy==="obscured"&&le(),i=a[0].taxon_geoprivacy==="obscured"&&oe();return{c(){e=_("dt"),t=T("Coordinates are obscured"),n=_("dd"),s&&s.c(),r=B(),i&&i.c(),this.h()},l(l){e=m(l,"DT",{class:!0});var u=h(e);t=N(u,"Coordinates are obscured"),u.forEach(o),n=m(l,"DD",{});var S=h(n);s&&s.l(S),r=Q(S),i&&i.l(S),S.forEach(o),this.h()},h(){y(e,"class","svelte-ny267m")},m(l,u){v(l,e,u),d(e,t),v(l,n,u),s&&s.m(n,null),d(n,r),i&&i.m(n,null)},p(l,u){l[0].geoprivacy==="obscured"?s||(s=le(),s.c(),s.m(n,r)):s&&(s.d(1),s=null),l[0].taxon_geoprivacy==="obscured"?i||(i=oe(),i.c(),i.m(n,null)):i&&(i.d(1),i=null)},d(l){l&&o(e),l&&o(n),s&&s.d(),i&&i.d()}}}function le(a){let e;return{c(){e=T("Observer has choosen to obscure the coordinates.")},l(t){e=N(t,"Observer has choosen to obscure the coordinates.")},m(t,n){v(t,e,n)},d(t){t&&o(e)}}}function oe(a){let e;return{c(){e=T("Taxon is threatened or rare so the coordinates are obscured.")},l(t){e=N(t,"Taxon is threatened or rare so the coordinates are obscured.")},m(t,n){v(t,e,n)},d(t){t&&o(e)}}}function fe(a){let e,t,n,r;return{c(){e=_("span"),t=T("Show on map"),this.h()},l(s){e=m(s,"SPAN",{class:!0});var i=h(e);t=N(i,"Show on map"),i.forEach(o),this.h()},h(){y(e,"class","link-color mr-4 svelte-ny267m")},m(s,i){v(s,e,i),d(e,t),n||(r=$(e,"click",a[6]),n=!0)},p:F,d(s){s&&o(e),n=!1,r()}}}function ue(a){let e,t,n,r,s;return{c(){e=_("a"),t=T("Species page"),this.h()},l(i){e=m(i,"A",{class:!0,href:!0});var l=h(e);t=N(l,"Species page"),l.forEach(o),this.h()},h(){y(e,"class","mr-4 svelte-ny267m"),y(e,"href",n=""+(a[1]+"/taxa/"+a[0].taxon_id))},m(i,l){v(i,e,l),d(e,t),r||(s=$(e,"click",a[7]),r=!0)},p(i,l){l&3&&n!==(n=""+(i[1]+"/taxa/"+i[0].taxon_id))&&y(e,"href",n)},d(i){i&&o(e),r=!1,s()}}}function Ee(a){let e,t,n=z(a[0],!0)+"",r,s,i,l,u,S,C,L,Y,G,A,X,U,b=a[0].user_login&&te(a),p=a[0].time_observed_at&&ie(a),g=a[0].quality_grade&&ae(a),D=a[0].license&&ne(a),w=a[0].description&&se(a),k=a[0].coordinates_obscured&&re(a),E=a[3]&&fe(a),O=a[0].taxon_id!==a[4].taxon_id&&ue(a);return{c(){e=_("div"),t=_("h3"),r=B(),s=_("dl"),b&&b.c(),i=M(),p&&p.c(),l=M(),g&&g.c(),u=M(),D&&D.c(),S=M(),w&&w.c(),C=M(),k&&k.c(),L=B(),E&&E.c(),Y=B(),O&&O.c(),G=B(),A=_("a"),X=T("iNaturalist observation"),this.h()},l(f){e=m(f,"DIV",{});var c=h(e);t=m(c,"H3",{class:!0});var de=h(t);de.forEach(o),r=Q(c),s=m(c,"DL",{class:!0});var j=h(s);b&&b.l(j),i=M(),p&&p.l(j),l=M(),g&&g.l(j),u=M(),D&&D.l(j),S=M(),w&&w.l(j),C=M(),k&&k.l(j),j.forEach(o),L=Q(c),E&&E.l(c),Y=Q(c),O&&O.l(c),G=Q(c),A=m(c,"A",{class:!0,href:!0});var H=h(A);X=N(H,"iNaturalist observation"),H.forEach(o),c.forEach(o),this.h()},h(){y(t,"class","svelte-ny267m"),P(t,"small",a[2]),y(s,"class","svelte-ny267m"),y(A,"class","external-link svelte-ny267m"),y(A,"href",U="https://www.inaturalist.org/observations/"+a[0].id),P(e,"prose",a[2]===!1),P(e,"p-4",!a[2])},m(f,c){v(f,e,c),d(e,t),t.innerHTML=n,d(e,r),d(e,s),b&&b.m(s,null),d(s,i),p&&p.m(s,null),d(s,l),g&&g.m(s,null),d(s,u),D&&D.m(s,null),d(s,S),w&&w.m(s,null),d(s,C),k&&k.m(s,null),d(e,L),E&&E.m(e,null),d(e,Y),O&&O.m(e,null),d(e,G),d(e,A),d(A,X)},p(f,[c]){c&1&&n!==(n=z(f[0],!0)+"")&&(t.innerHTML=n),c&4&&P(t,"small",f[2]),f[0].user_login?b?b.p(f,c):(b=te(f),b.c(),b.m(s,i)):b&&(b.d(1),b=null),f[0].time_observed_at?p?p.p(f,c):(p=ie(f),p.c(),p.m(s,l)):p&&(p.d(1),p=null),f[0].quality_grade?g?g.p(f,c):(g=ae(f),g.c(),g.m(s,u)):g&&(g.d(1),g=null),f[0].license?D?D.p(f,c):(D=ne(f),D.c(),D.m(s,S)):D&&(D.d(1),D=null),f[0].description?w?w.p(f,c):(w=se(f),w.c(),w.m(s,C)):w&&(w.d(1),w=null),f[0].coordinates_obscured?k?k.p(f,c):(k=re(f),k.c(),k.m(s,null)):k&&(k.d(1),k=null),f[3]?E?E.p(f,c):(E=fe(f),E.c(),E.m(e,Y)):E&&(E.d(1),E=null),f[0].taxon_id!==f[4].taxon_id?O?O.p(f,c):(O=ue(f),O.c(),O.m(e,G)):O&&(O.d(1),O=null),c&1&&U!==(U="https://www.inaturalist.org/observations/"+f[0].id)&&y(A,"href",U),c&4&&P(e,"prose",f[2]===!1),c&4&&P(e,"p-4",!f[2])},i:F,o:F,d(f){f&&o(e),b&&b.d(),p&&p.d(),g&&g.d(),D&&D.d(),w&&w.d(),k&&k.d(),E&&E.d(),O&&O.d()}}}function Oe(a,e,t){let{observation:n={}}=e,{projectPath:r}=e,{compactLayout:s=!1}=e,{enableZoomToObservation:i=!0}=e,{taxon:l={}}=e;const u=be();function S(){u("zoomToObservation",{observation_id:n.id,latitude:n.latitude,longitude:n.longitude})}const C=()=>u("changeTaxon",{taxon_id:n.taxon_id});return a.$$set=L=>{"observation"in L&&t(0,n=L.observation),"projectPath"in L&&t(1,r=L.projectPath),"compactLayout"in L&&t(2,s=L.compactLayout),"enableZoomToObservation"in L&&t(3,i=L.enableZoomToObservation),"taxon"in L&&t(4,l=L.taxon)},[n,r,s,i,l,u,S,C]}class Ue extends W{constructor(e){super();V(this,e,Oe,Ee,x,{observation:0,projectPath:1,compactLayout:2,enableZoomToObservation:3,taxon:4})}}export{Ge as L,Ue as O,Se as a,Ie as b,Ce as c,Pe as d,Be as e,Me as f,Qe as g,ze as h,Re as i,Ze as j,qe as l,Ae as m,je as r,Fe as s,Ye as u};
