import{S as Re,i as Ye,s as Ze,G as st,H as it,I as at,p as k,n as v,e as I,c as A,a as V,d as h,f as M,m as he,o as pe,ag as ft,q as ct,W as Je,ah as ut,E as mt,t as ae,g as fe,b as j,F as C,X as _t,J as ht,j as R,l as Y,O as Ue,v as F,w as q,N as He,x as G,h as Ie,A as W,u as pt,a5 as gt,a0 as Ae,k as X,L as Me}from"./vendor-358d5d08.js";import{a as De,E as dt,L as bt}from"./index-f3ef0f46.js";import{i as je,r as kt,e as vt,s as Ct,c as St}from"./mapUtils-e9636914.js";import{s as Mt,b as yt,u as Lt,c as Ot,d as Tt,e as wt,i as Et,m as Te}from"./dataUtils-977db69d.js";import{t as Bt,M as It,e as At,b as Dt,g as Pe,h as ze,i as Fe}from"./bar_chart-67213513.js";import{M as jt,a as Nt,b as Vt,S as Rt,c as Yt}from"./map_toggle_marker_type_button-de3816fe.js";import{C as Ne}from"./CircleMarker-8dfa560c.js";import"./formatUtils-b852786f.js";import"./constants-3d7024b8.js";function qe(t){let l;const n=t[17].default,r=mt(n,t,t[16],null);return{c(){r&&r.c()},l(e){r&&r.l(e)},m(e,a){r&&r.m(e,a),l=!0},p(e,a){r&&r.p&&(!l||a&65536)&&st(r,n,e,e[16],l?at(n,e[16],a,null):it(e[16]),null)},i(e){l||(k(r,e),l=!0)},o(e){v(r,e),l=!1},d(e){r&&r.d(e)}}}function Zt(t){let l,n,r=t[0]&&qe(t);return{c(){l=I("div"),r&&r.c()},l(e){l=A(e,"DIV",{});var a=V(l);r&&r.l(a),a.forEach(h)},m(e,a){M(e,l,a),r&&r.m(l,null),n=!0},p(e,[a]){e[0]?r?(r.p(e,a),a&1&&k(r,1)):(r=qe(e),r.c(),k(r,1),r.m(l,null)):r&&(he(),v(r,1,1,()=>{r=null}),pe())},i(e){n||(k(r),n=!0)},o(e){v(r),n=!1},d(e){e&&h(l),r&&r.d()}}}function Jt(t,l,n){let{$$slots:r={},$$scope:e}=l;const{getMap:a}=ft(De);let{latLngBounds:o}=l,{color:i="#3388ff"}=l,{weight:s=3}=l,{opacity:c=1}=l,{lineCap:p="round"}=l,{lineJoin:b="round"}=l,{dashArray:N=null}=l,{dashOffset:Z=null}=l,{fill:D=!0}=l,{fillColor:H="#3388ff"}=l,{fillOpacity:O=.2}=l,{fillRule:J="evenodd"}=l,{options:m={}}=l,{events:d=[]}=l,S;ct(De.Layer,{getLayer:()=>S});const P=Je();let U;ut(()=>{U.unregister(),S.removeFrom(a())});function T(){return S}return t.$$set=_=>{"latLngBounds"in _&&n(1,o=_.latLngBounds),"color"in _&&n(2,i=_.color),"weight"in _&&n(3,s=_.weight),"opacity"in _&&n(4,c=_.opacity),"lineCap"in _&&n(5,p=_.lineCap),"lineJoin"in _&&n(6,b=_.lineJoin),"dashArray"in _&&n(7,N=_.dashArray),"dashOffset"in _&&n(8,Z=_.dashOffset),"fill"in _&&n(9,D=_.fill),"fillColor"in _&&n(10,H=_.fillColor),"fillOpacity"in _&&n(11,O=_.fillOpacity),"fillRule"in _&&n(12,J=_.fillRule),"options"in _&&n(13,m=_.options),"events"in _&&n(14,d=_.events),"$$scope"in _&&n(16,e=_.$$scope)},t.$$.update=()=>{t.$$.dirty&32767&&(S||(n(0,S=De.rectangle(o,m).addTo(a())),U=new dt(S,P,d)),S.setBounds(o),S.setStyle({color:i,weight:s,opacity:c,lineCap:p,lineJoin:b,dashArray:N,dashOffset:Z,fill:D,fillColor:H,fillOpacity:O,fillRule:J}))},[S,o,i,s,c,p,b,N,Z,D,H,O,J,m,d,T,e,r]}class Ut extends Re{constructor(l){super();Ye(this,l,Jt,Zt,Ze,{latLngBounds:1,color:2,weight:3,opacity:4,lineCap:5,lineJoin:6,dashArray:7,dashOffset:8,fill:9,fillColor:10,fillOpacity:11,fillRule:12,options:13,events:14,getRectangle:15})}get getRectangle(){return this.$$.ctx[15]}}function Ge(t,l,n){const r=t.slice();return r[60]=l[n][0],r[0]=l[n][1],r}function We(t,l,n){const r=t.slice();return r[52]=l[n],r}function Xe(t,l,n){const r=t.slice();return r[55]=l[n][0],r[0]=l[n][1],r}function Ke(t,l,n){const r=t.slice();return r[52]=l[n],r}function Qe(t,l,n){const r=t.slice();return r[52]=l[n],r}function $e(t){let l,n,r,e,a,o;return{c(){l=I("span"),n=ae("*"),this.h()},l(i){l=A(i,"SPAN",{class:!0,title:!0});var s=V(l);n=fe(s,"*"),s.forEach(h),this.h()},h(){j(l,"class","text-red-600"),j(l,"title",r="Since there are over "+Ee+" observations on the map, the map uses clustered markers.")},m(i,s){M(i,l,s),C(l,n),a||(o=_t(e=Bt.call(null,l)),a=!0)},p:ht,d(i){i&&h(l),a=!1,o()}}}function Ht(t){let l,n,r=[...t[8]],e=[];for(let o=0;o<r.length;o+=1)e[o]=et(Ge(t,r,o));const a=o=>v(e[o],1,1,()=>{e[o]=null});return{c(){for(let o=0;o<e.length;o+=1)e[o].c();l=X()},l(o){for(let i=0;i<e.length;i+=1)e[i].l(o);l=X()},m(o,i){for(let s=0;s<e.length;s+=1)e[s].m(o,i);M(o,l,i),n=!0},p(o,i){if(i[0]&268448002){r=[...o[8]];let s;for(s=0;s<r.length;s+=1){const c=Ge(o,r,s);e[s]?(e[s].p(c,i),k(e[s],1)):(e[s]=et(c),e[s].c(),k(e[s],1),e[s].m(l.parentNode,l))}for(he(),s=r.length;s<e.length;s+=1)a(s);pe()}},i(o){if(!n){for(let i=0;i<r.length;i+=1)k(e[i]);n=!0}},o(o){e=e.filter(Boolean);for(let i=0;i<e.length;i+=1)v(e[i]);n=!1},d(o){Me(e,o),o&&h(l)}}}function Pt(t){let l,n,r=[...t[8]],e=[];for(let o=0;o<r.length;o+=1)e[o]=lt(Xe(t,r,o));const a=o=>v(e[o],1,1,()=>{e[o]=null});return{c(){for(let o=0;o<e.length;o+=1)e[o].c();l=X()},l(o){for(let i=0;i<e.length;i+=1)e[i].l(o);l=X()},m(o,i){for(let s=0;s<e.length;s+=1)e[s].m(o,i);M(o,l,i),n=!0},p(o,i){if(i[0]&268435714){r=[...o[8]];let s;for(s=0;s<r.length;s+=1){const c=Xe(o,r,s);e[s]?(e[s].p(c,i),k(e[s],1)):(e[s]=lt(c),e[s].c(),k(e[s],1),e[s].m(l.parentNode,l))}for(he(),s=r.length;s<e.length;s+=1)a(s);pe()}},i(o){if(!n){for(let i=0;i<r.length;i+=1)k(e[i]);n=!0}},o(o){e=e.filter(Boolean);for(let i=0;i<e.length;i+=1)v(e[i]);n=!1},d(o){Me(e,o),o&&h(l)}}}function zt(t){let l,n,r=t[8],e=[];for(let o=0;o<r.length;o+=1)e[o]=ot(Qe(t,r,o));const a=o=>v(e[o],1,1,()=>{e[o]=null});return{c(){for(let o=0;o<e.length;o+=1)e[o].c();l=X()},l(o){for(let i=0;i<e.length;i+=1)e[i].l(o);l=X()},m(o,i){for(let s=0;s<e.length;s+=1)e[s].m(o,i);M(o,l,i),n=!0},p(o,i){if(i[0]&268435714){r=o[8];let s;for(s=0;s<r.length;s+=1){const c=Qe(o,r,s);e[s]?(e[s].p(c,i),k(e[s],1)):(e[s]=ot(c),e[s].c(),k(e[s],1),e[s].m(l.parentNode,l))}for(he(),s=r.length;s<e.length;s+=1)a(s);pe()}},i(o){if(!n){for(let i=0;i<r.length;i+=1)k(e[i]);n=!0}},o(o){e=e.filter(Boolean);for(let i=0;i<e.length;i+=1)v(e[i]);n=!1},d(o){Me(e,o),o&&h(l)}}}function Ft(t){let l,n;return l=new Yt({props:{items:t[8]}}),{c(){F(l.$$.fragment)},l(r){q(l.$$.fragment,r)},m(r,e){G(l,r,e),n=!0},p(r,e){const a={};e[0]&256&&(a.items=r[8]),l.$set(a)},i(r){n||(k(l.$$.fragment,r),n=!0)},o(r){v(l.$$.fragment,r),n=!1},d(r){W(l,r)}}}function qt(t){let l,n;function r(...e){return t[40](t[52],...e)}return l=new Ut({props:{events:["click"],latLngBounds:[[t[52].latitude-t[12],t[52].longitude-t[13]],[t[52].latitude+t[12],t[52].longitude+t[13]]],color:t[1].colorSchemeMonth[t[60]]||t[1].defaultColor,fillColor:t[1].colorSchemeMonth[t[60]]||t[1].defaultColor}}),l.$on("click",r),{c(){F(l.$$.fragment)},l(e){q(l.$$.fragment,e)},m(e,a){G(l,e,a),n=!0},p(e,a){t=e;const o={};a[0]&12544&&(o.latLngBounds=[[t[52].latitude-t[12],t[52].longitude-t[13]],[t[52].latitude+t[12],t[52].longitude+t[13]]]),a[0]&258&&(o.color=t[1].colorSchemeMonth[t[60]]||t[1].defaultColor),a[0]&258&&(o.fillColor=t[1].colorSchemeMonth[t[60]]||t[1].defaultColor),l.$set(o)},i(e){n||(k(l.$$.fragment,e),n=!0)},o(e){v(l.$$.fragment,e),n=!1},d(e){W(l,e)}}}function Gt(t){let l,n;function r(...e){return t[39](t[52],...e)}return l=new Ne({props:{events:["click"],latLng:[t[52].latitude,t[52].longitude],radius:Ve,color:t[1].colorSchemeMonth[t[60]]||t[1].defaultColor,fillColor:t[1].colorSchemeMonth[t[60]]||t[1].defaultColor}}),l.$on("click",r),{c(){F(l.$$.fragment)},l(e){q(l.$$.fragment,e)},m(e,a){G(l,e,a),n=!0},p(e,a){t=e;const o={};a[0]&256&&(o.latLng=[t[52].latitude,t[52].longitude]),a[0]&258&&(o.color=t[1].colorSchemeMonth[t[60]]||t[1].defaultColor),a[0]&258&&(o.fillColor=t[1].colorSchemeMonth[t[60]]||t[1].defaultColor),l.$set(o)},i(e){n||(k(l.$$.fragment,e),n=!0)},o(e){v(l.$$.fragment,e),n=!1},d(e){W(l,e)}}}function xe(t){let l,n,r,e,a;const o=[Gt,qt],i=[];function s(c,p){return p[0]&256&&(l=null),l==null&&(l=!!St.includes(c[52].month+1)),l?0:1}return n=s(t,[-1,-1,-1]),r=i[n]=o[n](t),{c(){r.c(),e=X()},l(c){r.l(c),e=X()},m(c,p){i[n].m(c,p),M(c,e,p),a=!0},p(c,p){let b=n;n=s(c,p),n===b?i[n].p(c,p):(he(),v(i[b],1,1,()=>{i[b]=null}),pe(),r=i[n],r?r.p(c,p):(r=i[n]=o[n](c),r.c()),k(r,1),r.m(e.parentNode,e))},i(c){a||(k(r),a=!0)},o(c){v(r),a=!1},d(c){i[n].d(c),c&&h(e)}}}function et(t){let l,n,r=t[0],e=[];for(let o=0;o<r.length;o+=1)e[o]=xe(We(t,r,o));const a=o=>v(e[o],1,1,()=>{e[o]=null});return{c(){for(let o=0;o<e.length;o+=1)e[o].c();l=X()},l(o){for(let i=0;i<e.length;i+=1)e[i].l(o);l=X()},m(o,i){for(let s=0;s<e.length;s+=1)e[s].m(o,i);M(o,l,i),n=!0},p(o,i){if(i[0]&268448002){r=o[0];let s;for(s=0;s<r.length;s+=1){const c=We(o,r,s);e[s]?(e[s].p(c,i),k(e[s],1)):(e[s]=xe(c),e[s].c(),k(e[s],1),e[s].m(l.parentNode,l))}for(he(),s=r.length;s<e.length;s+=1)a(s);pe()}},i(o){if(!n){for(let i=0;i<r.length;i+=1)k(e[i]);n=!0}},o(o){e=e.filter(Boolean);for(let i=0;i<e.length;i+=1)v(e[i]);n=!1},d(o){Me(e,o),o&&h(l)}}}function tt(t){let l,n;function r(...e){return t[38](t[52],...e)}return l=new Ne({props:{events:["click"],latLng:[t[52].latitude,t[52].longitude],radius:Ve,color:t[1].colorSchemeYear[Te(t[55],t[1].colorSchemeYear.length)]||t[1].defaultColor,fillColor:t[1].colorSchemeYear[Te(t[55],t[1].colorSchemeYear.length)]||t[1].defaultColor}}),l.$on("click",r),{c(){F(l.$$.fragment)},l(e){q(l.$$.fragment,e)},m(e,a){G(l,e,a),n=!0},p(e,a){t=e;const o={};a[0]&256&&(o.latLng=[t[52].latitude,t[52].longitude]),a[0]&258&&(o.color=t[1].colorSchemeYear[Te(t[55],t[1].colorSchemeYear.length)]||t[1].defaultColor),a[0]&258&&(o.fillColor=t[1].colorSchemeYear[Te(t[55],t[1].colorSchemeYear.length)]||t[1].defaultColor),l.$set(o)},i(e){n||(k(l.$$.fragment,e),n=!0)},o(e){v(l.$$.fragment,e),n=!1},d(e){W(l,e)}}}function lt(t){let l,n,r=t[0],e=[];for(let o=0;o<r.length;o+=1)e[o]=tt(Ke(t,r,o));const a=o=>v(e[o],1,1,()=>{e[o]=null});return{c(){for(let o=0;o<e.length;o+=1)e[o].c();l=X()},l(o){for(let i=0;i<e.length;i+=1)e[i].l(o);l=X()},m(o,i){for(let s=0;s<e.length;s+=1)e[s].m(o,i);M(o,l,i),n=!0},p(o,i){if(i[0]&268435714){r=o[0];let s;for(s=0;s<r.length;s+=1){const c=Ke(o,r,s);e[s]?(e[s].p(c,i),k(e[s],1)):(e[s]=tt(c),e[s].c(),k(e[s],1),e[s].m(l.parentNode,l))}for(he(),s=r.length;s<e.length;s+=1)a(s);pe()}},i(o){if(!n){for(let i=0;i<r.length;i+=1)k(e[i]);n=!0}},o(o){e=e.filter(Boolean);for(let i=0;i<e.length;i+=1)v(e[i]);n=!1},d(o){Me(e,o),o&&h(l)}}}function ot(t){let l,n;function r(...e){return t[37](t[52],...e)}return l=new Ne({props:{events:["click"],latLng:[t[52].latitude,t[52].longitude],radius:Ve,color:t[1].defaultColor,fillColor:t[1].defaultColor}}),l.$on("click",r),{c(){F(l.$$.fragment)},l(e){q(l.$$.fragment,e)},m(e,a){G(l,e,a),n=!0},p(e,a){t=e;const o={};a[0]&256&&(o.latLng=[t[52].latitude,t[52].longitude]),a[0]&2&&(o.color=t[1].defaultColor),a[0]&2&&(o.fillColor=t[1].defaultColor),l.$set(o)},i(e){n||(k(l.$$.fragment,e),n=!0)},o(e){v(l.$$.fragment,e),n=!1},d(e){W(l,e)}}}function Wt(t){let l,n,r,e,a,o,i,s,c,p,b,N;l=new jt({props:{country:t[2].country,project:t[2]}});const Z=[Ft,zt,Pt,Ht],D=[];function H(m,d){return d[0]&256&&(r=null),m[15]?0:(r==null&&(r=!!Array.isArray(m[8])),r?1:m[1].observationsTimeSpan==="year"?2:3)}e=H(t,[-1,-1,-1]),a=D[e]=Z[e](t),i=new Nt({props:{map:t[4],coordinates:t[6]}});let O={coordinates:t[6],useMarkerCluster:t[15],observationsOnMapCount:t[18],clusterLimit:Ee,userSelectedMarkerType:t[16],zoomLevel:t[11],maxZoom:t[19]};c=new Vt({props:O}),t[41](c),c.$on("changeMarkerModeOnClick",t[24]),c.$on("changeMarkerModeAutomatic",t[25]);let J={position:"bottomleft",options:Ct};return b=new Rt({props:J}),t[42](b),{c(){F(l.$$.fragment),n=R(),a.c(),o=R(),F(i.$$.fragment),s=R(),F(c.$$.fragment),p=R(),F(b.$$.fragment)},l(m){q(l.$$.fragment,m),n=Y(m),a.l(m),o=Y(m),q(i.$$.fragment,m),s=Y(m),q(c.$$.fragment,m),p=Y(m),q(b.$$.fragment,m)},m(m,d){G(l,m,d),M(m,n,d),D[e].m(m,d),M(m,o,d),G(i,m,d),M(m,s,d),G(c,m,d),M(m,p,d),G(b,m,d),N=!0},p(m,d){const S={};d[0]&4&&(S.country=m[2].country),d[0]&4&&(S.project=m[2]),l.$set(S);let P=e;e=H(m,d),e===P?D[e].p(m,d):(he(),v(D[P],1,1,()=>{D[P]=null}),pe(),a=D[e],a?a.p(m,d):(a=D[e]=Z[e](m),a.c()),k(a,1),a.m(o.parentNode,o));const U={};d[0]&16&&(U.map=m[4]),d[0]&64&&(U.coordinates=m[6]),i.$set(U);const T={};d[0]&64&&(T.coordinates=m[6]),d[0]&32768&&(T.useMarkerCluster=m[15]),d[0]&262144&&(T.observationsOnMapCount=m[18]),d[0]&65536&&(T.userSelectedMarkerType=m[16]),d[0]&2048&&(T.zoomLevel=m[11]),d[0]&524288&&(T.maxZoom=m[19]),c.$set(T);const _={};b.$set(_)},i(m){N||(k(l.$$.fragment,m),k(a),k(i.$$.fragment,m),k(c.$$.fragment,m),k(b.$$.fragment,m),N=!0)},o(m){v(l.$$.fragment,m),v(a),v(i.$$.fragment,m),v(c.$$.fragment,m),v(b.$$.fragment,m),N=!1},d(m){W(l,m),m&&h(n),D[e].d(m),m&&h(o),W(i,m),m&&h(s),t[41](null),W(c,m),m&&h(p),t[42](null),W(b,m)}}}function nt(t){let l,n,r,e,a,o,i;return{c(){l=I("label"),n=I("input"),r=R(),e=I("span"),a=ae("Show species list"),this.h()},l(s){l=A(s,"LABEL",{class:!0});var c=V(l);n=A(c,"INPUT",{type:!0}),r=Y(c),e=A(c,"SPAN",{});var p=V(e);a=fe(p,"Show species list"),p.forEach(h),c.forEach(h),this.h()},h(){j(n,"type","checkbox"),j(l,"class","cursor-pointer mt-2 inline-block")},m(s,c){M(s,l,c),C(l,n),n.checked=t[22],C(l,r),C(l,e),C(e,a),o||(i=Ue(n,"change",t[45]),o=!0)},p(s,c){c[0]&4194304&&(n.checked=s[22])},d(s){s&&h(l),o=!1,i()}}}function Xt(t){let l,n,r,e,a,o,i,s,c,p,b,N,Z,D,H,O,J,m,d,S,P,U,T,_,ce,w,x,ue,me,de,ge,ee,K,_e,Q,te,le,be,$,oe,Ce,ye,E=t[18]>=Ee&&$e(),Be={options:t[1],$$slots:{default:[Wt]},$$scope:{ctx:t}};_=new bt({props:Be}),t[43](_);let y=t[23]&&nt(t);return Q=new It({props:{showSpeciesList:t[22],speciesList:t[9]}}),le=new At({props:{mapOptions:t[1],selectTimeSpanHandler:t[27],groupedObservations:t[7],toggleTimeSpans:t[26],timeSpanHistory:t[5],activeTaxaCount:1}}),{c(){l=I("div"),n=I("div"),r=I("div"),e=ae(`Observations
      `),E&&E.c(),a=R(),o=I("div"),i=ae(t[18]),s=R(),c=I("div"),p=I("div"),b=ae("Species"),N=R(),Z=I("div"),D=ae(t[20]),H=R(),O=I("div"),J=I("div"),m=ae("Observers"),d=R(),S=I("div"),P=ae(t[21]),U=R(),T=I("div"),F(_.$$.fragment),ce=R(),w=I("label"),x=I("input"),ue=R(),me=I("span"),de=ae("Update charts as map changes"),ge=R(),y&&y.c(),ee=R(),K=I("br"),_e=R(),F(Q.$$.fragment),te=R(),F(le.$$.fragment),be=R(),$=I("div"),this.h()},l(f){l=A(f,"DIV",{class:!0});var g=V(l);n=A(g,"DIV",{class:!0});var ne=V(n);r=A(ne,"DIV",{class:!0});var se=V(r);e=fe(se,`Observations
      `),E&&E.l(se),se.forEach(h),a=Y(ne),o=A(ne,"DIV",{class:!0});var ie=V(o);i=fe(ie,t[18]),ie.forEach(h),ne.forEach(h),s=Y(g),c=A(g,"DIV",{class:!0});var ke=V(c);p=A(ke,"DIV",{class:!0});var Le=V(p);b=fe(Le,"Species"),Le.forEach(h),N=Y(ke),Z=A(ke,"DIV",{class:!0});var Oe=V(Z);D=fe(Oe,t[20]),Oe.forEach(h),ke.forEach(h),H=Y(g),O=A(g,"DIV",{class:!0});var ve=V(O);J=A(ve,"DIV",{class:!0});var u=V(J);m=fe(u,"Observers"),u.forEach(h),d=Y(ve),S=A(ve,"DIV",{class:!0});var B=V(S);P=fe(B,t[21]),B.forEach(h),ve.forEach(h),g.forEach(h),U=Y(f),T=A(f,"DIV",{id:!0,style:!0});var z=V(T);q(_.$$.fragment,z),z.forEach(h),ce=Y(f),w=A(f,"LABEL",{class:!0});var re=V(w);x=A(re,"INPUT",{type:!0}),ue=Y(re),me=A(re,"SPAN",{});var Se=V(me);de=fe(Se,"Update charts as map changes"),Se.forEach(h),re.forEach(h),ge=Y(f),y&&y.l(f),ee=Y(f),K=A(f,"BR",{}),_e=Y(f),q(Q.$$.fragment,f),te=Y(f),q(le.$$.fragment,f),be=Y(f),$=A(f,"DIV",{id:!0,class:!0}),V($).forEach(h),this.h()},h(){j(r,"class","stat-title svelte-oe1iet"),j(o,"class","stat-value svelte-oe1iet"),j(n,"class","stat place-items-center place-content-center svelte-oe1iet"),j(p,"class","stat-title svelte-oe1iet"),j(Z,"class","stat-value svelte-oe1iet"),j(c,"class","stat place-items-center place-content-center svelte-oe1iet"),j(J,"class","stat-title svelte-oe1iet"),j(S,"class","stat-value svelte-oe1iet"),j(O,"class","stat place-items-center place-content-center svelte-oe1iet"),j(l,"class","w-full rounded-none border stats"),j(T,"id","taxa-map"),He(T,"width","100%"),He(T,"height","400px"),j(x,"type","checkbox"),j(w,"class","cursor-pointer mt-2 mr-3 inline-block"),j($,"id","observations-chart"),j($,"class","w-full mt-4")},m(f,g){M(f,l,g),C(l,n),C(n,r),C(r,e),E&&E.m(r,null),C(n,a),C(n,o),C(o,i),C(l,s),C(l,c),C(c,p),C(p,b),C(c,N),C(c,Z),C(Z,D),C(l,H),C(l,O),C(O,J),C(J,m),C(O,d),C(O,S),C(S,P),M(f,U,g),M(f,T,g),G(_,T,null),M(f,ce,g),M(f,w,g),C(w,x),x.checked=t[10],C(w,ue),C(w,me),C(me,de),M(f,ge,g),y&&y.m(f,g),M(f,ee,g),M(f,K,g),M(f,_e,g),G(Q,f,g),M(f,te,g),G(le,f,g),M(f,be,g),M(f,$,g),oe=!0,Ce||(ye=Ue(x,"change",t[44]),Ce=!0)},p(f,g){f[18]>=Ee?E?E.p(f,g):(E=$e(),E.c(),E.m(r,null)):E&&(E.d(1),E=null),(!oe||g[0]&262144)&&Ie(i,f[18]),(!oe||g[0]&1048576)&&Ie(D,f[20]),(!oe||g[0]&2097152)&&Ie(P,f[21]);const ne={};g[0]&2&&(ne.options=f[1]),g[0]&1046870|g[2]&8&&(ne.$$scope={dirty:g,ctx:f}),_.$set(ne),g[0]&1024&&(x.checked=f[10]),f[23]?y?y.p(f,g):(y=nt(f),y.c(),y.m(ee.parentNode,ee)):y&&(y.d(1),y=null);const se={};g[0]&4194304&&(se.showSpeciesList=f[22]),g[0]&512&&(se.speciesList=f[9]),Q.$set(se);const ie={};g[0]&2&&(ie.mapOptions=f[1]),g[0]&128&&(ie.groupedObservations=f[7]),g[0]&32&&(ie.timeSpanHistory=f[5]),le.$set(ie)},i(f){oe||(k(_.$$.fragment,f),k(Q.$$.fragment,f),k(le.$$.fragment,f),oe=!0)},o(f){v(_.$$.fragment,f),v(Q.$$.fragment,f),v(le.$$.fragment,f),oe=!1},d(f){f&&h(l),E&&E.d(),f&&h(U),f&&h(T),t[43](null),W(_),f&&h(ce),f&&h(w),f&&h(ge),y&&y.d(f),f&&h(ee),f&&h(K),f&&h(_e),W(Q,f),f&&h(te),W(le,f),f&&h(be),f&&h($),Ce=!1,ye()}}}let Ve=8,Kt="oldest",we=.25,Ee=1e3;function Qt(t,l,n){let{observations:r}=l,{mapOptions:e}=l,{mapCenter:a}=l,{project:o}=l,{taxon:i}=l,{limitTaxaToSpecies:s=!1}=l,c,p,b={},N=0,Z=1,D=1,H=[],O=[],J=[];const m=Je();let d=!1,S=JSON.parse(JSON.stringify(Dt)),P,U=!1,T="markers",_,ce=[],w=[],x=0,ue=!1,me=0,de=0,ge=0,ee=!1,K=[],_e=[],Q=!1,te=!1;function le(u){n(15,U=u.detail.useMarkerCluster),n(16,T=u.detail.userSelectedMarkerType),n(8,w=$(w))}function be(u){n(15,U=u.detail.useMarkerCluster),n(8,w=$(w))}function $(u){let B;if(Array.isArray(u))B=u.filter(z=>je(z,p,L));else if(U){let z=[];u.forEach((re,Se)=>{re=re.filter(rt=>je(rt,p,L)),z=z.concat(re)}),B=z}else B=new Map,u.forEach((z,re)=>{z=z.filter(Se=>je(Se,p,L)),B.set(re,z)});return B}function oe(u){n(12,Z=kt(u)),n(13,D=vt(u))}function Ce(u){n(5,b=Lt(u,b))}function ye(){n(5,b={})}function E(u,B){m("markerClick",{observation_id:B.id,latlng:u.detail.latlng})}function Be(u){u.length>0&&p.fitBounds(u),m("doneLoading")}function y(u){gt("#observations-chart",u,{actions:!1}).then(B=>{}).catch(console.warn)}pt(()=>{n(33,d=!0),n(4,p=c.getMap()),n(11,N=p.getZoom()),n(19,me=p.getMaxZoom()),oe(N),p.on("zoomend",function(){n(11,N=p.getZoom()),n(35,ue=!0),oe(N)}),p.on("moveend",function(){n(35,ue=!0)})});const f=(u,B)=>E(B,u),g=(u,B)=>E(B,u),ne=(u,B)=>E(B,u),se=(u,B)=>E(B,u);function ie(u){Ae[u?"unshift":"push"](()=>{_=u,n(17,_)})}function ke(u){Ae[u?"unshift":"push"](()=>{P=u,n(14,P)})}function Le(u){Ae[u?"unshift":"push"](()=>{c=u,n(3,c)})}function Oe(){te=this.checked,n(10,te)}function ve(){ee=this.checked,n(22,ee)}return t.$$set=u=>{"observations"in u&&n(0,r=u.observations),"mapOptions"in u&&n(1,e=u.mapOptions),"mapCenter"in u&&n(29,a=u.mapCenter),"project"in u&&n(2,o=u.project),"taxon"in u&&n(30,i=u.taxon),"limitTaxaToSpecies"in u&&n(31,s=u.limitTaxaToSpecies)},t.$$.update=()=>{if(t.$$.dirty[0]&1&&(n(0,r=r.filter(u=>u.latitude&&u.longitude)),n(6,H=r.map(u=>[u.latitude,u.longitude])),n(5,b={})),t.$$.dirty[0]&163|t.$$.dirty[1]&2&&(n(32,J=Mt(r,Kt,e.observationsTimeSpan)),n(7,O=yt(J,e.observationsTimeSpan)),e.observationsTimeSpan!=="all"&&Object.keys(b).length===0&&O.forEach((u,B)=>n(5,b[B]=!0,b))),t.$$.dirty[0]&72&&c&&Be(H),t.$$.dirty[0]&1073742760|t.$$.dirty[1]&57&&c&&(n(34,ce=Ot(O,b)),n(8,w=$(ce)),n(18,x=Tt(w)),n(9,K=wt(w,s)),n(20,de=K.length),n(36,_e=Et(w,s)),n(21,ge=_e.length),n(23,Q=K.length>1||K.length==1&&K[0].taxon_id!==i.taxon_id),n(35,ue=!1)),t.$$.dirty[0]&1190|t.$$.dirty[1]&4&&d&&!te){if(e.observationsTimeSpan==="month"){let u=Pe(S,we,b,e,O,o);y(u)}else if(e.observationsTimeSpan==="year"){let u=ze(S,we,b,e,O,o);y(u)}else if(e.observationsTimeSpan==="all"){let u=Fe(S,e,O);y(u)}}if(t.$$.dirty[0]&1318|t.$$.dirty[1]&4&&d&&te){if(e.observationsTimeSpan==="month"){let u=Pe(S,we,b,e,w,o);y(u)}else if(e.observationsTimeSpan==="year"){let u=ze(S,we,b,e,w,o);y(u)}else if(e.observationsTimeSpan==="all"){let u=Fe(S,e,w);y(u)}}t.$$.dirty[0]&536870936&&c&&a&&a.longitude&&(document.getElementById("taxa-map").scrollIntoView(),p.flyTo([a.latitude,a.longitude],p.getMaxZoom()-1),n(29,a={}))},[r,e,o,c,p,b,H,O,w,K,te,N,Z,D,P,U,T,_,x,me,de,ge,ee,Q,le,be,Ce,ye,E,a,i,s,J,d,ce,ue,_e,f,g,ne,se,ie,ke,Le,Oe,ve]}class il extends Re{constructor(l){super();Ye(this,l,Qt,Xt,Ze,{observations:0,mapOptions:1,mapCenter:29,project:2,taxon:30,limitTaxaToSpecies:31},null,[-1,-1,-1])}}export{il as default};
